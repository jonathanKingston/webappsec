<!doctype html>
<html lang="en">
 <head>
  
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  
  
  <title>Confinement with Origin Web Labels</title>
  
  
  <link href="../default.css" rel="stylesheet" type="text/css">
  
  
  <style>
  body {
    background: url("https://www.w3.org/StyleSheets/TR/logo-ED") top left no-repeat white;
    background-attachment: fixed;
    color: black;
    font-family: sans-serif;
    margin: 0 auto;
    max-width: 50em;
    padding: 2em 1em 2em 70px;
  }
  :link { color: #00C; background: transparent }
  :visited { color: #609; background: transparent }
  a[href]:active { color: #C00; background: transparent }
  a[href]:hover { background: #ffa }

  a[href] img { border-style: none }

  h1, h2, h3, h4, h5, h6 { text-align: left }
  h1, h2, h3 { color: #005A9C; }
  h1 { font: 170% sans-serif }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  h4 { font: bold 100% sans-serif }
  h5 { font: italic 100% sans-serif }
  h6 { font: small-caps 100% sans-serif }

  .hide { display: none }

  div.head { margin-bottom: 1em }
  div.head h1 { margin-top: 2em; clear: both }
  div.head table { margin-left: 2em; margin-top: 2em }

  p.copyright { font-size: small }
  p.copyright small { font-size: small }

  pre { margin-left: 2em }
  dt { font-weight: bold }

  ul.toc, ol.toc {
    list-style: none;
  }
  </style>
  

  <meta content="Bikeshed 1.0.0" name="generator">
 </head>
 

 <body class="h-entry">

  <div class="head">
  
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72">
</a>
</p>
  
   <h1 class="p-name no-ref" id="title">Confinement with Origin Web Labels</h1>
  
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft,
    <time class="dt-updated" datetime="2015-08-11">11 August 2015</time></span></h2>
  
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/webappsec/specs/cowl/">https://w3c.github.io/webappsec/specs/cowl/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5BCOWL%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[COWL] <var>… message topic …</var></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/deian/webappsec/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:deian@cs.stanford.edu">Deian Stefan</a> (<span class="p-org org">Stanford University</span>)
    </dl>
   </div>
  
   <div data-fill-with="warning"></div>
  
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
</p>
  
   <hr title="Separator for header">
</div>


  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>

  <div class="p-summary" data-fill-with="abstract">
   <p>This specification defines an API for specifying privacy and

integrity policies on data, in the form of origin labels, and a
mechanism for confining code according to such policies.  This
allows Web application authors and server operators to shared data
with untrusted—buggy but not malicious—code (e.g., in a mashup
scenario) yet impose restrictions on how the code can share the data
further.</p>

</div>


  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>

  <div data-fill-with="status">
   <p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

</p>
   <p>
  <strong>Changes to this document may be tracked at
  <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong>

</p>
   <p>
	The (<a href="http://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list
	<a href="mailto:public-webappsec@w3.org?Subject=%5BCOWL%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
	(see <a href="http://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “COWL” in the subject,
	preferably like this:
	“[COWL] <em>…summary of comment…</em>”

</p>
   <p>
	This document was produced by the
  <a href="http://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>.

</p>
   <p>
	This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a>
	must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.

</p>
   <p>
  This document is governed by the <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">1 August 2014 W3C Process Document</a>.

</p></div>

  <div data-fill-with="at-risk"></div>


  <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>

  <div data-fill-with="table-of-contents" role="navigation">
   <ul class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ul class="toc">
      <li><a href="#goals"><span class="secno">1.1</span> <span class="content">Goals</span></a>
      <li><a href="#examples"><span class="secno">1.2</span> <span class="content">Use Cases/Examples</span></a>
       <ul class="toc">
        <li><a href="#confining-untrusted-third_party-services"><span class="secno">1.2.1</span> <span class="content">Confining untrusted third-party services</span></a>
        <li><a href="#examples-mashup"><span class="secno">1.2.2</span> <span class="content">Sharing data with third-party mashups</span></a>
        <li><a href="#examples-isolation"><span class="secno">1.2.3</span> <span class="content">Content isolation via privilege separation</span></a>
        <li><a href="#examples-leastpriv"><span class="secno">1.2.4</span> <span class="content">Running content with least-privileges</span></a>
       </ul>
      <li><a href="#trust-model"><span class="secno">1.3</span> <span class="content">Trust Model</span></a>
     </ul>
    <li><a href="#key-concepts"><span class="secno">2</span> <span class="content">Key Concepts and Terminology</span></a>
     <ul class="toc">
      <li><a href="#labels"><span class="secno">2.1</span> <span class="content">Labels</span></a>
      <li><a href="#privileges"><span class="secno">2.2</span> <span class="content">Privileges</span></a>
     </ul>
    <li><a href="#framework"><span class="secno">3</span> <span class="content">Framework</span></a>
     <ul class="toc">
      <li><a href="#label0"><span class="secno">3.1</span> <span class="content">Label interface</span></a>
       <ul class="toc">
        <li><a href="#constructors"><span class="secno">3.1.1</span> <span class="content">Constructors</span></a>
        <li><a href="#methods"><span class="secno">3.1.2</span> <span class="content">Methods</span></a>
       </ul>
      <li><a href="#privileges0"><span class="secno">3.2</span> <span class="content">Privilege Interface</span></a>
       <ul class="toc">
        <li><a href="#constructors0"><span class="secno">3.2.1</span> <span class="content">Constructors</span></a>
        <li><a href="#methods0"><span class="secno">3.2.2</span> <span class="content">Methods</span></a>
       </ul>
      <li><a href="#context-labels"><span class="secno">3.3</span> <span class="content">Labeled Contexts and Workers Interface</span></a>
       <ul class="toc">
        <li><a href="#attributes"><span class="secno">3.3.1</span> <span class="content">Attributes</span></a>
        <li><a href="#methods1"><span class="secno">3.3.2</span> <span class="content">Methods</span></a>
       </ul>
      <li><a href="#object-labels"><span class="secno">3.4</span> <span class="content">Labeled Objects Interface</span></a>
       <ul class="toc">
        <li><a href="#constructors1"><span class="secno">3.4.1</span> <span class="content">Constructors</span></a>
        <li><a href="#attributes0"><span class="secno">3.4.2</span> <span class="content">Attributes</span></a>
        <li><a href="#methods2"><span class="secno">3.4.3</span> <span class="content">Methods</span></a>
        <li><a href="#extensions-to-xmlhttprequest"><span class="secno">3.4.4</span> <span class="content">Extensions to <span>XMLHttpRequest</span></span></a>
         <ul class="toc">
          <li><a href="#request"><span class="secno">3.4.4.1</span> <span class="content">Request</span></a>
          <li><a href="#response"><span class="secno">3.4.4.2</span> <span class="content">Response</span></a>
         </ul>
       </ul>
      <li><a href="#response-header"><span class="secno">3.5</span> <span class="content">The <code>COWL</code> HTTP Response Header Field</span></a>
      <li><a href="#request-header"><span class="secno">3.6</span> <span class="content">The <code>COWL</code> HTTP Request Header Field</span></a>
     </ul>
    <li><a href="#lworkers"><span class="secno">4</span> <span class="content">Light-weight Workers</span></a>
     <ul class="toc">
      <li><a href="#lworker-global"><span class="secno">4.1</span> <span class="content">The <span>LWorkerGlobalScope</span> interface</span></a>
     </ul>
    <li><a href="#algorithms"><span class="secno">5</span> <span class="content">Algorithms</span></a>
     <ul class="toc">
      <li><a href="#reduce-to-normal-form"><span class="secno">5.1</span> <span class="content">Label Normal Form Reduction</span></a>
      <li><a href="#subsumes-check"><span class="secno">5.2</span> <span class="content">Label Subsumption</span></a>
      <li><a href="#label-reduce"><span class="secno">5.3</span> <span class="content">Label Downgrade</span></a>
      <li><a href="#taint-context"><span class="secno">5.4</span> <span class="content">Context Tainting</span></a>
      <li><a href="#write-check"><span class="secno">5.5</span> <span class="content">Write Check</span></a>
      <li><a href="#labeldobject-serialization"><span class="secno">5.6</span> <span class="content">Serializing Labeld Objects</span></a>
     </ul>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ul class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content">Conformance Classes</span></a>
     </ul>
    <li><a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ul class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ul>
    <li><a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ul class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ul>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ul></div>

  <main>









   <section>
  
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>


    <p><em>This section is not normative.</em></p>


    <p>Modern Web applications are conglomerations of JavaScript written by
  multiple authors. Authors routinely incorporate third-party scripts
  into their applications and share user data with third-party
  services (e.g., as part of a <em>mashup</em>).  Unfortunately, in
  the existing model, the user’s data confidentiality and integrity is
  put at risk when one incorporates untrusted third-party code or
  shares data with untrusted third-party services.</p>


    <p>Mechanisms such as CORS and CSP can be used to mitigate these risks
  by giving authors control over whom they share data with. But, once
  data is shared, these mechanisms do not impose any restrictions on
  how the code that was granted access can further disseminate the
  data.</p>


    <p>This document specifies an extension to the current model called
  Confinement with Origin Web Labels (COWL). COWL provides authors
  with APIs for specifying access control policies on data, including
  content, in terms of <a data-link-type="dfn" href="#origin-label">origin labels</a>.  These policies are
  enforced in a mandatory fashion, transitively, even once code has
  access to the data.  For example, with COWL, the author of
  <code>https://example.com</code> can specify that a password is
  confidential to <code>https://example.com</code> (and thus should
  only be disclosed to <code>https://example.com</code>) before
  sharing it with a third-party password strength checking service. In
  turn, COWL ensures that the third-party service, which necessarily
  computes on the sensitive password, is confined and respects the
  policy on the password, i.e., COWL disallows it from disclosing the
  password to any origin other than <code>https://example.com</code>.</p>


    <p>COWL enforces such policies by confining code, at the
  <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">context</a>-level, according to the sensitivity (i.e., the label)
  of the data the code has observed. To reap the greatest benefits of
  COWL, authors will need to compartmentalize applications into
  multiple contexts (e.g., <a data-link-type="dfn" href="http://www.w3.org/TR/html5/embedded-content-0.html#the-iframe-element">iframes</a>).</p>


    <p>In the existing model, any page served from an origin has the
  ambient, implicit authority of that origin.  This documents
  generalizes this notion of authority and gives authors explicit
  control over it with <a data-link-type="dfn" href="#privilege">privileges</a>.  For example, by default, a
  page whose origin is <code>https://example.com</code> has the
  privilege for <code>https://example.com</code>. This gives the page
  the authority to arbitrarily disseminate data sensitive to
  <code>https://example.com</code>, i.e., to be backwards-compatible,
  the page is not confined when reading data sensitive to
  <code>https://example.com</code>.  However, COWL allows the author
  to run the page with a "weaker" privilege (e.g., one corresponding the
  current user at <code>https://example.com</code>) or drop the
  privilege altogether.</p>


    <p>COWL is intended to be used as a defense-in-depth mechanism that can
  restrict how untrusted code sensitive data.  Authors should
  still use discretionary access control mechanisms, such as CSP and
  CORS, to restrict access to the data in the first place.</p>


  
    <section>
  
     <h3 class="heading settled" data-level="1.1" id="goals"><span class="secno">1.1. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
     


     <p>The goal of COWL is to provide authors with a means for protecting
  the confidentiality and integrity of data that is shared with
  untrusted, whether third-party or their own, code.  Existing
  mechanisms (e.g., CORS and the <a data-link-type="functionish" href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a> <a class="idl-code" data-link-type="argument">targetOrigin</a> argument) provide a way for
  restricting which origins may access the shared data.  But, once
  content has access to data it can usually disseminate it without
  restrictions.  While CSP can be used to confine code, i.e.,
  restrict how confidential data is disseminated, setting a correct
  CSP policy (as to confine code) is difficult and limited to
  content the author has control over. Indeed, sharing confidential
  data in the existing model (e.g., via cross-document messaging)
  implicitly requires the author to trust the receiver not to leak the
  data, accidentally or otherwise.  COWL provides a defense-in-depth
  option for protecting data confidentiality and integrity.  In
  particular, with COWL:</p>
     

  


     <ol>
      <li data-md="">
       <p>Authors should be able to specify confidentiality and integrity
policies on data in terms of origin labels: the origins to whom the
data is confidential and the origins that endorse the data.  This
allows authors to share sensitive data with third-party content and
impose restrictions on the origins with which it can communicate
once it inspects the sensitive data. Dually, it allows authors to
share data via intermediate content while retaining its integrity.</p>
       


      <li data-md="">
       <p>Authors should be able to run code with <em>least privilege</em>
by restricting the origins the code can communicate with and thus
how it can disseminate sensitive data.</p>
       


      <li data-md="">
       <p>Authors should be able to <em>privilege separate</em>
applications by compartmentalizing them into separate contexts that
have <a data-link-type="dfn" href="#delegated-privilege">delegated privileges</a>.</p>
       
</ol>
     
  
    </section>

  
    <section>
  
     <h3 class="heading settled" data-level="1.2" id="examples"><span class="secno">1.2. </span><span class="content">Use Cases/Examples</span><a class="self-link" href="#examples"></a></h3>
     
  
     <h4 class="heading settled" data-level="1.2.1" id="confining-untrusted-third_party-services"><span class="secno">1.2.1. </span><span class="content">Confining untrusted third-party services</span><a class="self-link" href="#confining-untrusted-third_party-services"></a></h4>
     


     <p>An author wishes to use a service, loaded in the form of an iframe,
  without trusting it (or its dependencies) to not leak her
  sensitive data. To protect the data, the author associates a
  confidentiality <a data-link-type="dfn" href="#label">label</a> with the data, specifying the origins
  allowed to read the data.  The author then shares the newly created
  <a data-link-type="dfn" href="#labeled-objects">labeled object</a> with the untrusted code.  In turn, COWL
  confines the untrusted code once it inspects the sensitive data, as
  to ensure that it can only communicate according to the
  author-specified policy—the label.</p>
     

  
     <div class="example" id="example-checker"><a class="self-link" href="#example-checker"></a>
    Consider using a third-party password strength checker provided by
    <code>https://untrusted.com</code>.  To protect the
    confidentiality of the password, the
    <code>https://example.com</code> application can use COWL to
    associate a confidentiality policy, in the form of a <a data-link-type="dfn" href="#label">label</a>,
    with the password before sending it to the untrusted service:

    
      <pre><code>// Create new policy using <a class="idl-code" data-link-type="interface" href="#label1">Label</a>s that specifies that the password is sensitive
// to https://example.com and should only be disclosed to this origin:
var policy = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>(window.location.origin);

// Associate the label with the password:
var labeldPassword = new <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>(password, {confidentiality: policy});

// Send the labeled password to the checker iframe:
checker.postMessage(labeledPassword, "https://untrusted.com");

// Register listener to receive a response from checker, etc.
</code></pre>
      


      <p>Once the checker inspects the password, COWL limits the iframe to
    communicating with origins that preserve the password’s
    confidentiality (in this case, <code>https://example.com</code>).
    Indeed, this policy is enforced mandatorily, even if the
    <code>https://untrusted.com</code> service sends the password to
    yet another iframe.</p>
      


      <p class="note" role="note">Note, until the checker actually inspects the labeld password, it
    can freely communicate with any origins, e.g., with
    <code>https://untrusted.com</code>.  This is important since the
    checker may need to fetch resources (e.g., regular expressions) to
    check the password strength.  Note that this is also safe: the
    checker has not inspected the sensitive password, and thus need
    not be confined.</p>
      
  
     </div>
     


     <p>Other use cases in this categroty include password managers and
  encrypted document editors, for example, where an
  encryption/decription layer and storage layer are provided by
  distrusting, but not malicious, services.  The academic paper on
  COWL describes these use cases in detail <a data-link-type="biblio" href="#biblio-cowl-osdi">[COWL-OSDI]</a>.</p>
     

  
     <h4 class="heading settled" data-level="1.2.2" id="examples-mashup"><span class="secno">1.2.2. </span><span class="content">Sharing data with third-party mashups</span><a class="self-link" href="#examples-mashup"></a></h4>
     


     <p>A server operator wishes to provide third-party mashups access to
  user data. In addition to using CORS response headers to restrict the
  <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origins</a> that can access the data <a data-link-type="biblio" href="#biblio-cors">[CORS]</a>, the operator
  wishes to restrict how the data is further disseminated by these
  origins. To do so, the operator sends a response header
  field named <code>COWL</code> (described in <a href="#response-header">§3.5 The COWL HTTP Response Header Field</a>)
  whose value contains the sensitivity of the data in the form of a
  serialized confidentiality <a data-link-type="dfn" href="#label">label</a>.  In turn, COWL enforces the label
  restrictions on the third-party code, once it inspects the response.</p>
     

  
     <div class="example" id="example-e360629a"><a class="self-link" href="#example-e360629a"></a>
  The server operator of <code>https://a.com</code> uses a CORS
  response header to grant <code>https://b.com</code> access to a
  resource. The operator also sets a <code>COWL</code> header to
  specify that the resource is confidential to
  <code>https://a.com</code> and should not be disseminated
  arbitrarily:

  
      <pre><code><a data-link-type="dfn" href="http://www.w3.org/TR/cors/#access-control-allow-origin-response-header">Access-Control-Allow-Origin</a>: https://b.com
<a href="#response-header">COWL</a>: confidentiality: [ ["https://a.com"] ]
</code></pre>
      


      <p>Once a <code>https://b.com</code> context read the response, COWL
  imposes the label restrictions
  (<code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code>) and restricts
  the code’s ability to only disseminate the data to
  <code>https://a.com</code>.</p>
      


      <p class="issue" id="issue-f288fb98"><a class="self-link" href="#issue-f288fb98"></a> mention labeled-blob</p>
      
  
     </div>
     


  
     <h4 class="heading settled" data-level="1.2.3" id="examples-isolation"><span class="secno">1.2.3. </span><span class="content">Content isolation via privilege separation</span><a class="self-link" href="#examples-isolation"></a></h4>
     


     <p>A server operator wishes to isolate content (e.g., of different
  users) while serving it from a single physical <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>.  The
  operator can leverage <a data-link-type="dfn" href="#privilege">privileges</a> to ensure that content of
  one part of the site has different authority from
  another—equivalent to having a different origin—and,
  importantly, does not have authority of the physical origin.
  Concretly, when serving content, the operator can specify that the
  content’s <a data-link-type="dfn" href="#context-privilege">context privilege</a> should be a <a data-link-type="dfn" href="#delegated-privilege">delegated
  privilege</a>. This esnures that the content is privilege separated.</p>
     

  
     <div class="example" id="example-bcef9c08"><a class="self-link" href="#example-bcef9c08"></a>
    Suppose <code>https://university.edu</code> wished to isolate
    different parts of their site according to users. The server
    operator can weaken the privilege of a page when serving user
    content by providing a response header field named
    <code>COWL</code> (see <a href="#response-header">§3.5 The COWL HTTP Response Header Field</a>) whose value contains
    the serialized <a data-link-type="dfn" href="#delegated-privilege">delegated privilege</a>. For example, for any
    resources under <code>https://university.edu/~user1</code>, the
    following header should be set:

    
      <pre><code><a href="#response-header">COWL</a>: privilege: [ ['self', 'cowl://user1'] ]
</code></pre>
      


      <p>Having this privilege (which corresponds to the label
    <code><a data-link-type="dfn" href="#label">Label</a>("https://university.edu").or("user1")</code>)
    can be understood as having the authority of <code>user1</code>’s
    part of the <code>https://university.edu</code> origin.</p>
      


      <p>Specifically, COWL ensures that the content of one user cannot
    interfere with <code>https://university.edu</code>’s or another
    user’s content, e.g.  <code>https://university.edu/~user2</code>.
    For example, the content cannot modify
    <code>https://university.edu</code> cookies or the DOM of another
    <code>http://university.edu</code> page.</p>
      


      <p>Additionally, the <a data-link-type="dfn" href="#delegated-privilege">delegated privilege</a> ensures that the
    content cannot disseminate data sensitive to another user (e.g.,
    <code>user2</code>) arbitrarily—it can only disseminate
    <code>user1</code>’s data on <code>http://university.edu</code>.
    Of course, this requires that the server operator label sensitive data
    (e.g., when sending it to the client) appropriately (e.g.,
    <code>user2</code>’s data is labeled
    <code><a data-link-type="dfn" href="#label">Label</a>("https://university.edu").or("user2")</code>).</p>
      
  
     </div>
     

  
     <div class="note" role="note">
    Note, sub-domains should be used when possible to ensure that
    content is isolated using the Same-Origin Policy. But, even in
    such casese, COWL can provide a useful layer of defense.
  </div>
     

  
     <h4 class="heading settled" data-level="1.2.4" id="examples-leastpriv"><span class="secno">1.2.4. </span><span class="content">Running content with least-privileges</span><a class="self-link" href="#examples-leastpriv"></a></h4>
     


     <p>An author wishes to use a library that is tightly coupled with
  the page (e.g. jQuery), but avoid the need to trust the library to
  protect the user’s confidentiality and integrity. With COWL, the
  author can do this by <a data-link-type="dfn" href="#dropping-privileges">dropping privileges</a> (from the context’s
  <a data-link-type="dfn" href="#default-privilege">default privilege</a>) and then loading the untrusted library.
  In doing so, the content loses its implicit authority over the
  content’s origin.</p>
     

  
     <div class="example" id="example-2ce2da47"><a class="self-link" href="#example-2ce2da47"></a>
    Author of <code>https://example.com</code> can drop privileges in
    JavaScript:

    
      <pre><code>// Drop privileges:
COWL.privilege = new <a data-link-type="functionish" href="#dom-privilege-privilege">Privilege()</a>;

// ... code to load untrusted library ...
</code></pre>
      


      <p>Or, by setting the content’s initial privilege to the <a data-link-type="dfn" href="#empty-privilege">empty
      privilege</a> using <code>COWL</code> response header:</p>
      

    
      <pre><code><a href="#response-header">COWL</a>: privilege: [ [] ]
</code></pre>
      


      <p class="note" role="note">Note, while this ensures that the context code cannot, for instance,
    access the origin’s cookies, the author must still associate a
    confidentiality label with resources (e.g., responses sent to the
    client) to ensure that data is properly protected.</p>
      
  
     </div>
     


     <p>In some cases it is useful for a particular context to have the
  privilege to disseminate certain category of data.  (The
  <code>or</code> part of <a data-link-type="dfn" href="#label">labels</a> can be used to easily
  categorize differently-sensitive data.) To this end, the author
  should run the context with a <a data-link-type="dfn" href="#delegated-privilege">delegated privilege</a> instead of
  the <a data-link-type="dfn" href="#empty-privilege">empty privilege</a>. The above <a href="#examples-isolation">§1.2.3 Content isolation via privilege separation</a> shows
  one such example.</p>
     


  
    </section>
  
    <section>
    
     <h3 class="heading settled" data-level="1.3" id="trust-model"><span class="secno">1.3. </span><span class="content">Trust Model</span><a class="self-link" href="#trust-model"></a></h3>
     
    COWL provides developers with a way of imposing restrictions on
    how untrusted code can disseminate sensitive data.  However,
    authors should not share sensitive data with malicious code, since
    such code may be able to exploit covert channels, which are present
    in most browsers, to leak the data.  COWL can only prevent
    information leakage from code that (e.g., is buggy and) uses
    overt communication channels.


     <p>Similarly, COWL provides no guarantees agains attacks wherein
    users are manipulated into leaking sensitive data via out-of-band
    channels.  For example, an attacker may be able to convince the
    user to navigate their user agent to an attacker-owned origin by
    entering a URL that contains sensitive information into the user
    agent’s address bar.</p>
     

    
     <div class="note" role="note">
      COWL should be used as an additional defense layer to other
      security mechanisms such as CSP, SRI, CORS, and iframe <code><a data-link-type="element-attr" href="http://www.w3.org/TR/html5/embedded-content-0.html#attr-iframe-sandbox">sandbox</a></code>.
    </div>
     
  
    </section>
</section>



   <section>
  
    <h2 class="heading settled" data-level="2" id="key-concepts"><span class="secno">2. </span><span class="content">Key Concepts and Terminology</span><a class="self-link" href="#key-concepts"></a></h2>
  
    <h3 class="heading settled" data-level="2.1" id="labels"><span class="secno">2.1. </span><span class="content">Labels</span><a class="self-link" href="#labels"></a></h3>
  
    <ol>
    
     <li>
      An <dfn data-dfn-type="dfn" data-noexport="" id="origin-label">origin label<a class="self-link" href="#origin-label"></a></dfn>, or more succinctly a
      <dfn data-dfn-type="dfn" data-noexport="" id="label">label<a class="self-link" href="#label"></a></dfn>, encodes either a confidentiality or integrity
      security policy as conjuctive normal form (AND’s and OR’s)
      formulae over <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>s.  Labels can be associated with
      <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">contexts</a> or with <a data-link-type="dfn" href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structurally clonable</a> objects.


      <p>When associated with a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">context</a>, the label restricts the
      origins that the context can communicate with, as detailed in
      <a href="#context-labels">§3.3 Labeled Contexts and Workers Interface</a>.</p>
      

      
      <div class="example" id="example-8bcc417c"><a class="self-link" href="#example-8bcc417c"></a>
       When associate with a context, the confidentiality label
       <code>
          <a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com").<a data-link-type="dfn">or</a>("https://b.com")
       </code>
       restricts the context to sending data to
       <code>https://a.com</code> or <code>https://b.com</code>, but
       no other origins.
       The context label reflects the fact the context may contain data
       that is sensitive to either <code>https://a.com</code> or
       <code>https://b.com</code>; it is thus only safe for it to
       communicate <em>to</em> these origins.


       <p class="note" role="note">Note, because the context can communicate data to either origin,
       another context associated with the more restricting
       <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code> label cannot
       send it data. Doing so would allow for data confidential
       to <code>https://a.com</code> to be leaked to <code>https://b.com</code>.</p>
       
      
      </div>
      


      <p>When associated with an object, a confidentiality label
      specifies the origins to whom the object is sensitive, while an
      integrity label specifies the origins that endorse the object.
      Objects that have labels associated with them are called
      <dfn data-dfn-type="dfn" data-noexport="" id="labeled-objects">labeled objects<a class="self-link" href="#labeled-objects"></a></dfn>.  <a href="#object-labels">§3.4 Labeled Objects Interface</a> defines how
      labels are associated with objects.</p>
      

      
      <div class="example" id="example-c29ec1fc"><a class="self-link" href="#example-c29ec1fc"></a>
        Consider an <code>https://example.com</code> page that
        receives a labeled object (e.g., via <a data-link-type="functionish" href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a>)
        with the following labels:


       <ul>
        <li data-md="">
         <p>Confidentiality:
<code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://example.com")</code>.
This label indicates that the object is sensitive to
<code>https://example.com</code>.</p>
         


        <li data-md="">
         <p>Integrity:
<code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code>.  This
label indicates that the object has been endorsed by
<code>https://a.com</code>. If
<code>https://example.com</code> received the message from an
intermediary <code>https://b.com</code> context, this label
reflects the fact that the object (produced by
<code>https://a.com</code>) was not tampered.</p>
         
</ul>
             
      </div>
      
    
     
    
     <li>
      Mathematically, a label is a <em>conjunctive normal form</em>
      formula over origins <a data-link-type="biblio" href="#biblio-dclabels">[DCLabels]</a>.


      <p>A label is in <dfn data-dfn-type="dfn" data-noexport="" id="normal-form">normal form<a class="self-link" href="#normal-form"></a></dfn> if reducing it according to
      the <a data-link-type="dfn" href="#label-normal-form-reduction">label normal form reduction</a> algorithm produces the
      same value.</p>
      


      <p>Two labels are <dfn data-dfn-type="dfn" data-noexport="" id="equivalent">equivalent<a class="self-link" href="#equivalent"></a></dfn> if their <a data-link-type="dfn" href="#normal-form">normal form</a>
      values are mathematically equal.</p>
      


      <p>A label <var>A</var> <dfn data-dfn-type="dfn" data-noexport="" id="subsumes">subsumes<a class="self-link" href="#subsumes"></a></dfn> (or is more
      <dfn data-dfn-type="dfn" data-noexport="" id="restricting">restricting<a class="self-link" href="#restricting"></a></dfn> than) another label
      <var>B</var> if the result of running the <a data-link-type="dfn" href="#label-subsumption">label subsumption</a>
      algorithm on the <a data-link-type="dfn" href="#normal-form">normal form</a>s of <var>A</var> and
      <var>B</var> returns <code>true</code>. Labels are partially
      ordered according to this subsumes relation.</p>
      
    
     
    
     <li>
      The <dfn data-dfn-type="dfn" data-noexport="" id="current-confidentiality-label">current confidentiality label<a class="self-link" href="#current-confidentiality-label"></a></dfn> is the
      confidentiality label associated with the current context.
      <a href="#context-labels">§3.3 Labeled Contexts and Workers Interface</a> specifies how labels are associated with
      contexts.
    
     
    
     <li>
      The <dfn data-dfn-type="dfn" data-noexport="" id="current-integrity-label">current integrity label<a class="self-link" href="#current-integrity-label"></a></dfn> is the
      integrity label associated with the current context.
      <a href="#context-labels">§3.3 Labeled Contexts and Workers Interface</a> specifies how labels are associated with
      contexts.
    
     
    
     <li>
      When reading a <a data-link-type="dfn" href="#labeled-objects">labeled object</a> a context gets
      <dfn data-dfn-type="dfn" data-noexport="" id="tainted">tainted<a class="self-link" href="#tainted"></a></dfn>, i.e., its context labels are updated by
      invoking <a data-link-type="dfn" href="#context-tainting">context tainting</a> algorithm, to reflect that it
      has read sensitive data and should be confined accordingly.
    
     
  
    </ol>
  
    <h3 class="heading settled" data-level="2.2" id="privileges"><span class="secno">2.2. </span><span class="content">Privileges</span><a class="self-link" href="#privileges"></a></h3>
  
    <ol>
    
     <li>
      A <dfn data-dfn-type="dfn" data-noexport="" id="privilege">privilege<a class="self-link" href="#privilege"></a></dfn> is an unforgeable object that corresponds
      to a <a data-link-type="dfn" href="#label">label</a>. Privileges are associated with contexts and
      reflect the authority of the context.


      <p>Privileges can be used to bypass confinement restrictions
      imposed by confidentiality labels.  In particular, a privilege
      can be used to bypass the restrictions imposed by any label
      its corresponding label—the
      <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a>—subsumes.</p>
      

      
      <div class="example" id="example-1741c6c9"><a class="self-link" href="#example-1741c6c9"></a>
        Consider a context whose
        <a data-link-type="dfn" href="#current-confidentiality-label">current confidentiality label</a> is <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com").and("https://b.com")</code>.
        This label confines the context to only communicating with
        entities whose labels are at least as restricting as this
        label. For example, it restricts the context from
        communicating with a context labeled <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://b.com")</code>, since doing
        so could leak <code>https://a.com</code> data to 
        <code>https://b.com</code>. It similarly prevents the context
        from communicating with <code>https://a.com</code>.


       <p>Howerver, supose that the context’s <a data-link-type="dfn" href="#current-privilege">current privilege</a> corresponds
        to <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code>, as
        would be the case for an
        <code>https://a.com</code> context. Then, the context would be able to
        bypass some of the restriction imposed by the context label.  In particular,
        the context would be able to communicate with
        <code>https://b.com</code>—the privilege confers the
        right to declassify <code>https://a.com</code> data to
        <code>https://b.com</code>; when taking privileges into
        consideration, the <a data-link-type="dfn" href="#effective-confidentiality-label">effective confidentiality label</a> of
        the context is <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://b.com")</code>.</p>
       


       <p class="note" role="note">Note, the privilege does not allow the context to bypass any
        label restrictions. For example, it does not allow the context
        to communicate with <code>https://a.com</code> since doing so
        could leak <code>https://b.com</code> data.</p>
       

        
       <div class="note" role="note">
          To be flexilibe, COWL uses the context privilege remove (the
          safe) restrictions imposed by the <a data-link-type="dfn">context label</a>.  To
          avoid accidentally leaking sensitive context data, authors
          should use <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>s.
        </div>
       

      
      </div>
      


      <p>Privileges can also be used to bypass integrity restrictions
      imposed by integrity labels. In particular, a privilege can be
      used to endorse an otherwise untrustworthy <a data-link-type="dfn">labeled
      context</a> (or <a data-link-type="dfn" href="#labeled-objects">labeled object</a>) as to allow it to
      communicate with more trustworthy end-points (another context or
      server).</p>
      

      
      <div class="example" id="example-6da8a883"><a class="self-link" href="#example-6da8a883"></a>
        Consider an <code>https://a.com</code> context whose
        <a data-link-type="dfn" href="#current-integrity-label">current integrity label</a> is
        <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com").or("https://b.com")</code>.
        This label confines the context to only communicating with
        entities that are at most as trustworthy as this
        label. For example, it restricts the context from
        communicating with a context whose <a data-link-type="dfn" href="#current-integrity-label">current integrity
        label</a> is
        <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code>, since doing
        so would potentially corrupt
        <code>https://a.com</code> data (e.g., the computation may
        be influenced by <code>https://b.com</code>).


       <p>However, if the context’s <a data-link-type="dfn" href="#current-privilege">current privilege</a> corresponds
        to <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code>, then
        it would be able to bypass the integrity restrictions.  In
        particular, the context would be able to communicate with the
        more trustworthy context since the privilege confers it the
        right to endorse the context on behalf of
        <code>https://a.com</code>. Indeed, when taking privileges
        into account, the <a data-link-type="dfn" href="#effective-integrity-label">effective integrity label</a> of the
        context is <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com")</code>.</p>
       


       <p class="note" role="note">Note, the privilege cannot be used to bypass any restrictions.
        For example, it does not allow the context to communicate with
        a context whose integrity label is <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>(https://b.com)</code>.</p>
       
      
      </div>
      


      <p class="note" role="note">Note, <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">browsing contexts</a> have a <a data-link-type="dfn" href="#current-privilege">current privilege</a>
      that, by default, corresponds to the origin of the context, as
      described in <a href="#context-labels">§3.3 Labeled Contexts and Workers Interface</a>. But, authors can set the <a data-link-type="dfn" href="#current-privilege">current
      privilege</a> to a <a data-link-type="dfn" href="#delegated-privilege">delegated privilege</a> when following the
      principle of least privilege.</p>
      
    
     
    
     <li>
      The <dfn data-dfn-type="dfn" data-noexport="" id="current-privilege">current privilege<a class="self-link" href="#current-privilege"></a></dfn> is the privilege associated
      with the current context. <a href="#context-labels">§3.3 Labeled Contexts and Workers Interface</a> specifies how
      privileges are associated with contexts.
    
     
    
     <li>
      The <dfn data-dfn-type="dfn" data-noexport="" id="effective-confidentiality-label">effective confidentiality label<a class="self-link" href="#effective-confidentiality-label"></a></dfn> is the label
      returned by the <a data-link-type="dfn" href="#label-downgrade">label downgrade</a> algorithm when invoked
      with the <a data-link-type="dfn" href="#current-confidentiality-label">current confidentiality label</a> and <a data-link-type="dfn" href="#current-privilege">current
      privilege</a>.
    
     
    
     <li>
      The <dfn data-dfn-type="dfn" data-noexport="" id="effective-integrity-label">effective integrity label<a class="self-link" href="#effective-integrity-label"></a></dfn> is the label
      returned by the <a data-link-type="dfn" href="#label-downgrade">label downgrade</a> algorithm when invoked
      with the <a data-link-type="dfn" href="#current-integrity-label">current integrity label</a> and <a data-link-type="dfn" href="#current-privilege">current
      privilege</a>.
    
     
    
     <li>
      Code can take <dfn data-dfn-type="dfn" data-noexport="" id="ownership">ownership<a class="self-link" href="#ownership"></a></dfn> of a <a data-link-type="dfn" href="#privilege">privilege</a>
      <var>priv</var> by
      setting the <a data-link-type="dfn" href="#current-privilege">current privilege</a> to the privilege produced
      by <a data-link-type="dfn">combining</a> the <a data-link-type="dfn" href="#current-privilege">current privilege</a> and
      <var>priv</var>.


      <p class="issue" id="issue-cc6f8db9"><a class="self-link" href="#issue-cc6f8db9"></a> define combining</p>
      
    
     

    </ol></section>



   <section>
  
    <h2 class="heading settled" data-level="3" id="framework"><span class="secno">3. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>

  
    <section>
    
     <h3 class="heading settled" data-level="3.1" id="label0"><span class="secno">3.1. </span><span class="content">Label interface</span><a class="self-link" href="#label0"></a></h3>
     


     <p>Each <a data-link-type="dfn" href="#label">label</a> is represented by a <a class="idl-code" data-link-type="interface" href="#label1">Label</a>
    object, the interface of which is defined in this section.</p>
     


     <p>A <a class="idl-code" data-link-type="interface" href="#label1">Label</a> MUST have an internal <dfn data-dfn-type="dfn" data-noexport="" id="label-set">label set<a class="self-link" href="#label-set"></a></dfn>, which is
    a non-empty set of <a data-link-type="dfn" href="#disjunction-set">disjunction set</a>s.</p>
     


     <p>A <dfn data-dfn-type="dfn" data-noexport="" id="disjunction-set">disjunction set<a class="self-link" href="#disjunction-set"></a></dfn> is a set of <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>
    <a data-link-type="dfn" href="http://dom.spec.whatwg.org/#concept-document-url">URL</a>s.</p>
     


     <p>A label is said to be an <dfn data-dfn-type="dfn" data-noexport="" id="empty-label">empty label<a class="self-link" href="#empty-label"></a></dfn> if its <a data-link-type="dfn" href="#label-set">label
      set</a> contains a single, empty <a data-link-type="dfn" href="#disjunction-set">disjunction set</a>.</p>
     

    
     <pre class="idl">[<a class="idl-code" data-link-type="constructor" href="#dom-label-label">Constructor</a>, <a class="idl-code" data-link-type="constructor" href="#dom-label-labelorigin">Constructor</a>(DOMString <dfn class="idl-code" data-dfn-for="Label/Label(origin)" data-dfn-type="argument" data-export="" id="dom-label-labelorigin-origin">origin<a class="self-link" href="#dom-label-labelorigin-origin"></a></dfn>)]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="label1">Label<a class="self-link" href="#label1"></a></dfn> {
  boolean <a class="idl-code" data-link-type="method" href="#dom-label-equalsother">equals</a>(<a data-link-type="idl-name" href="#label1">Label</a> <dfn class="idl-code" data-dfn-for="Label/equals(other)" data-dfn-type="argument" data-export="" id="dom-label-equalsother-other">other<a class="self-link" href="#dom-label-equalsother-other"></a></dfn>);
  boolean <a class="idl-code" data-link-type="method" href="#dom-label-subsumesother">subsumes</a>(<a data-link-type="idl-name" href="#label1">Label</a> <dfn class="idl-code" data-dfn-for="Label/subsumes(other)" data-dfn-type="argument" data-export="" id="dom-label-subsumesother-other">other<a class="self-link" href="#dom-label-subsumesother-other"></a></dfn>);

  <a data-link-type="idl-name" href="#label1">Label</a> <dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" data-lt="and(other)" id="dom-label-andother">and<a class="self-link" href="#dom-label-andother"></a></dfn>((<a data-link-type="idl-name" href="#label1">Label</a> or DOMString) <dfn class="idl-code" data-dfn-for="Label/and(other)" data-dfn-type="argument" data-export="" id="dom-label-andother-other">other<a class="self-link" href="#dom-label-andother-other"></a></dfn>);
  <a data-link-type="idl-name" href="#label1">Label</a> <dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" data-lt="_or(other)" id="dom-label-_orother">_or<a class="self-link" href="#dom-label-_orother"></a></dfn>((<a data-link-type="idl-name" href="#label1">Label</a> or DOMString) <dfn class="idl-code" data-dfn-for="Label/_or(other)" data-dfn-type="argument" data-export="" id="dom-label-_orother-other">other<a class="self-link" href="#dom-label-_orother-other"></a></dfn>);

  object <dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" data-lt="toJSON()" id="dom-label-tojson">toJSON<a class="self-link" href="#dom-label-tojson"></a></dfn>();
  [Throws] static <a data-link-type="idl-name" href="#label1">Label</a> <dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" data-lt="fromJSON(obj)" id="dom-label-fromjsonobj">fromJSON<a class="self-link" href="#dom-label-fromjsonobj"></a></dfn>(object <dfn class="idl-code" data-dfn-for="Label/fromJSON(obj)" data-dfn-type="argument" data-export="" id="dom-label-fromjsonobj-obj">obj<a class="self-link" href="#dom-label-fromjsonobj-obj"></a></dfn>);
};
</pre>
     


     <p class="issue" id="issue-afa876b4"><a class="self-link" href="#issue-afa876b4"></a> Current WebIDL implementation requires an underscore for
    certain identifiers. Can we rename <code>_or</code> to
    <code>or</code>?</p>
     

    
     <h4 class="heading settled" data-level="3.1.1" id="constructors"><span class="secno">3.1.1. </span><span class="content">Constructors</span><a class="self-link" href="#constructors"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="Label" data-dfn-type="constructor" data-export="" id="dom-label-label">Label()<a class="self-link" href="#dom-label-label"></a></dfn>
      
      
      <dd>
        When invoking the <a data-link-type="functionish" href="#dom-label-label">Label()</a> constructor, the user agent
        MUST return a new <a data-link-type="dfn" href="#empty-label">empty label</a>.
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="Label" data-dfn-type="constructor" data-export="" data-lt="Label(origin)" id="dom-label-labelorigin">Label(DOMString origin)<a class="self-link" href="#dom-label-labelorigin"></a></dfn>
      
      
      <dd>
        When invoking the <a data-link-type="functionish" href="#dom-label-label">Label(origin)</a> constructor, the user agent
        MUST use an algorithm equivalent to the following:


       <ol>
        <li data-md="">
         <p>If the <a class="idl-code" data-link-type="argument" href="#dom-label-labelorigin-origin">origin</a>
argument is not a <a data-link-type="dfn" href="http://dom.spec.whatwg.org/#concept-document-url">URL</a>, the constructor MUST throw a
<code>TypeError</code> exception <a data-link-type="biblio" href="#biblio-ecma-262">[ECMA-262]</a> and
terminate this algorithm.</p>
         


        <li data-md="">
         <p>Else, it MUST return a new <a data-link-type="dfn" href="#label">Label</a> that contains a
<a data-link-type="dfn" href="#label-set">label set</a> of a single <a data-link-type="dfn" href="#disjunction-set">disjunction set</a>, which
itself MUST contain the <a data-link-type="dfn" href="http://dom.spec.whatwg.org/#concept-document-url">URL</a> corresponding to the
<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> of the parameter.</p>
         
</ol>
             
      
    
     </dl>
     

    
     <h4 class="heading settled" data-level="3.1.2" id="methods"><span class="secno">3.1.2. </span><span class="content">Methods</span><a class="self-link" href="#methods"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" data-lt="equals(other)" id="dom-label-equalsother" title="equals(other)">equals(Label other)<a class="self-link" href="#dom-label-equalsother"></a></dfn>
      
      
      <dd>
        MUST return <code>true</code> if the <a class="idl-code" data-link-type="interface" href="#label1">Label</a> on
        which the method has been called is <a data-link-type="dfn" href="#equivalent">equivalent</a> to the
        <a class="idl-code" data-link-type="argument" href="#dom-label-equalsother-other">other</a>
        parameter; otherwise it MUST return <code>false</code>
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" data-lt="subsumes(other)" id="dom-label-subsumesother" title="subsumes(other)">subsumes(Label other)<a class="self-link" href="#dom-label-subsumesother"></a></dfn>
      
      
      <dd>
        MUST return <code>true</code> if the <a class="idl-code" data-link-type="interface" href="#label1">Label</a> on
        which the method has been called <a data-link-type="dfn" href="#subsumes">subsumes</a> the
        <a class="idl-code" data-link-type="argument" href="#dom-label-subsumesother-other">other</a>
        parameter; otherwise it MUST return <code>false</code>
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" id="dom-label-andlabel-or-domstring-other" title="and(other)">and((Label or DOMString) other)<a class="self-link" href="#dom-label-andlabel-or-domstring-other"></a></dfn>
      
      
      <dd>
        The user agent MUST use an algorithm equivalent to the following:


       <ol>
        <li data-md="">
         <p>Let <var>O</var> be the
<a class="idl-code" data-link-type="argument" href="#dom-label-andother-other">other</a> argument.</p>
         


        <li data-md="">
         <p>If the type of <a class="idl-code" data-link-type="argument" href="#dom-label-andother-other">other</a> is
<a data-link-type="dfn">DOMString</a>, run the following sub-steps:</p>
         


         <ol>
          <li data-md="">
           <p>Set <var>O</var> to the result of invoking the
<a data-link-type="functionish" href="#dom-label-label">Label()</a> constructor with <a class="idl-code" data-link-type="argument" href="#dom-label-andother-other">other</a> as an argument, if the
constructor did not raise an exception.</p>
           


          <li data-md="">
           <p>Else, re-throw the exception and terminate this algorithm.</p>
           
</ol>
         

        <li data-md="">
         <p>Return a new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>, in <a data-link-type="dfn" href="#normal-form">normal form</a>, which is
<a data-link-type="dfn" href="#equivalent">equivalent</a> to adding <var>O</var>’s <a data-link-type="dfn" href="#label-set">label set</a> to
the <a data-link-type="dfn" href="#label-set">label set</a> of the <a class="idl-code" data-link-type="interface" href="#label1">Label</a> on which
the method was invoked.</p>
         
</ol>
             
      
      
      <dt><dfn class="idl-code" data-dfn-for="Label" data-dfn-type="method" data-export="" id="dom-label-_orlabel-or-domstring-other" title="_or(other)">_or((Label or DOMString) other)<a class="self-link" href="#dom-label-_orlabel-or-domstring-other"></a></dfn>
      
      
      <dd>
        The user agent MUST use an algorithm equivalent to the following:


       <ol>
        <li data-md="">
         <p>Let <var>O</var> be the
<a class="idl-code" data-link-type="argument" href="#dom-label-andother-other">other</a> argument.</p>
         


        <li data-md="">
         <p>If the type of <a class="idl-code" data-link-type="argument" href="#dom-label-_orother-other">other</a> is
<a data-link-type="dfn">DOMString</a>, run the following sub-steps:</p>
         


         <ol>
          <li data-md="">
           <p>Set <var>O</var> to the result of invoking the
<a data-link-type="functionish" href="#dom-label-label">Label()</a> constructor with <a class="idl-code" data-link-type="argument" href="#dom-label-_orother-other">other</a> as an argument, if the
constructor did not raise an exception.</p>
           


          <li data-md="">
           <p>Else, re-throw the exception and terminate this algorithm.</p>
           
</ol>
         

        <li data-md="">
         <p>Return a new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>, in <a data-link-type="dfn" href="#normal-form">normal form</a>,
which is <a data-link-type="dfn" href="#equivalent">equivalent</a> to adding each element of each
<a data-link-type="dfn" href="#disjunction-set">disjunction set</a> of <var>O</var>’s <a data-link-type="dfn" href="#label-set">label set</a> to
each <a data-link-type="dfn" href="#disjunction-set">disjunction set</a> of the <a data-link-type="dfn" href="#label-set">label set</a> of the
<a class="idl-code" data-link-type="interface" href="#label1">Label</a> on which the method was called.</p>
         
</ol>
             
      
    
     </dl>
     


     <p class="issue" id="issue-620ca5f0"><a class="self-link" href="#issue-620ca5f0"></a> describe the <a data-link-type="functionish" href="#dom-label-tojson">toJSON()</a> and <a data-link-type="functionish" href="#dom-label-fromjsonobj">fromJSON()</a></p>
     

    
     <div class="example" id="example-edfd5c8c"><a class="self-link" href="#example-edfd5c8c"></a>
      Example labels. Intuition for each label’s semantics is given in
      the context of it being used as a confidentiality label (C) and
      integrity label (I).
      
      <pre><code>// Create an empty label.
// C: This corresponds to public data.
// I: This corresponds to non-endorsed/untrustworthy data.
var empty = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>();

// C: Data confidential to a.com.
// I: Data endorsed/trusted by a.com.
var a = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com");

// C: Data confidential to b.com.
// I: Data endorsed/trusted by b.com.
var a = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://b.com");

// C: Data confidential to both a.com and b.com
// I: Data endorsed/trusted by a.com and b.com.
var aANDb = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com").and("https://b.com");

// C: Data confidential to either a.com or b.com.
// I: Data endorsed/trusted by either a.com or b.com.
var aORb = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://a.com").or("https://b.com");
</code></pre>
      

      <p>Examples of label comparisons with intuition for the semantics.</p>
      
      
      <pre><code>// C: a.com data is more sensitive than public data.
// I: data endorsed by a.com is more trustworthy than non-endorsed/untrustworthy data.
a.subsumes(empty) === true;
b.subsumes(empty) === true;

// C: Data that is confidential to a.com and b.com is more
// confidential than data that is only sensitive to a.com.
//
// I: Data that is endorsed/trusted by both a.com and b.com is
// more trustworthy than data endorsed only by a.com
aANDb.subsumes(a) === true;
aANDb.subsumes(b) === true;

// C: Data that that is confidential to a.com is not comparable to
// data that is confidential to b.com
//
// I: Data that that is endorsed by a.com is not comparable to
// data that is endorsed to b.com
a.subsumes(b) === false;
b.subsumes(a) === false;

// C: Data that is confidential to a.com is more confidential than data that is confidential
// to either a.com or b.com. Alternative intuition: data that can be read by a.com or b.com
// can necessarily be read by an entity that can read a.com data alone.
//
// I: Data that is endorsed by a.com is more trustworthy than data that is endorsed/trusted
// by either a.com or b.com. Alternative intuition: an entity that trusts data that is
// endorsed by either a.com or b.com necessarily trusts data endorsed by a.com alone.
a.subsumes(aOrb) === true;
b.subsumes(aOrb) === true;
</code></pre>
      
    
     </div>
     
  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="3.2" id="privileges0"><span class="secno">3.2. </span><span class="content">Privilege Interface</span><a class="self-link" href="#privileges0"></a></h3>
     


     <p>Each <a data-link-type="dfn" href="#privilege">privilege</a> is represented by a <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> object, the interface of which is
    defined in this section.</p>
     


     <p>A <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> MUST have an <dfn data-dfn-type="dfn" data-noexport="" id="internal-privilege-label">internal privilege
    label<a class="self-link" href="#internal-privilege-label"></a></dfn>.</p>
     


     <p>The <dfn data-dfn-type="dfn" data-noexport="" id="combination">combination<a class="self-link" href="#combination"></a></dfn> of privileges <var>A</var> and
    <var>B</var> is a privilege produced by invoking the
    <a data-link-type="functionish" href="#dom-privilege-combineother">combine()</a> method on <var>A</var> (respectively,
    <var>B</var>) with <var>B</var> (respectively, <var>A</var>) as an
    argument.</p>
     


     <p>A privilege is said to be an <dfn data-dfn-type="dfn" data-noexport="" id="empty-privilege">empty privilege<a class="self-link" href="#empty-privilege"></a></dfn> if its
    <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> is the <a data-link-type="dfn" href="#empty-label">empty label</a>. A
    context is said to be <dfn data-dfn-type="dfn" data-noexport="" id="unprivileged">unprivileged<a class="self-link" href="#unprivileged"></a></dfn> if its context
    privilege is the <a data-link-type="dfn" href="#empty-privilege">empty privilege</a>.  By setting the
    <a data-link-type="dfn" href="#context-privilege">context privilege</a> to the <a data-link-type="dfn" href="#empty-privilege">empty privilege</a>, a context
    is said to be <dfn data-dfn-type="dfn" data-noexport="" id="dropping-privileges">dropping privileges<a class="self-link" href="#dropping-privileges"></a></dfn>.</p>
     


     <p>A privilege <var>P1</var> is said to be a <dfn data-dfn-type="dfn" data-noexport="" id="delegated-privilege">delegated
      privilege<a class="self-link" href="#delegated-privilege"></a></dfn> of <var>P2</var> if <var>P2</var>’s <a data-link-type="dfn" href="#internal-privilege-label">internal
      privilege label</a> subsumes <var>P1</var>’s <a data-link-type="dfn" href="#internal-privilege-label">internal
    privilege label</a>.</p>
     

    
     <pre class="idl">[<a class="idl-code" data-link-type="constructor" href="#dom-privilege-privilege">Constructor</a>, <a class="idl-code" data-link-type="constructor" href="#dom-privilege-freshprivilege">NamedConstructor</a>=<a data-link-type="idl-name">FreshPrivilege</a>]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="privilege0">Privilege<a class="self-link" href="#privilege0"></a></dfn> {
  <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="method" href="#dom-privilege-aslabel">asLabel</a>();

  <a data-link-type="idl-name" href="#privilege0">Privilege</a> <a class="idl-code" data-link-type="method" href="#dom-privilege-combineother">combine</a>(<a data-link-type="idl-name" href="#privilege0">Privilege</a> <dfn class="idl-code" data-dfn-for="Privilege/combine(other)" data-dfn-type="argument" data-export="" id="dom-privilege-combineother-other">other<a class="self-link" href="#dom-privilege-combineother-other"></a></dfn>);
  [Throws] <a data-link-type="idl-name" href="#privilege0">Privilege</a> <a class="idl-code" data-link-type="method" href="#dom-privilege-delegatelabel">delegate</a>(<a data-link-type="idl-name" href="#label1">Label</a> <dfn class="idl-code" data-dfn-for="Privilege/delegate(label)" data-dfn-type="argument" data-export="" id="dom-privilege-delegatelabel-label">label<a class="self-link" href="#dom-privilege-delegatelabel-label"></a></dfn>);
};
</pre>
     
    
     <h4 class="heading settled" data-level="3.2.1" id="constructors0"><span class="secno">3.2.1. </span><span class="content">Constructors</span><a class="self-link" href="#constructors0"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="Privilege" data-dfn-type="constructor" data-export="" id="dom-privilege-privilege">Privilege()<a class="self-link" href="#dom-privilege-privilege"></a></dfn>
      
      
      <dd>
      When invoking the <a data-link-type="functionish" href="#dom-privilege-privilege">Privilege()</a> constructor, the user
      agent MUST return a new <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> that has an
      <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> set to
      <code><a data-link-type="functionish" href="#dom-label-label">Label()</a></code>.
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="Privilege" data-dfn-type="constructor" data-export="" id="dom-privilege-freshprivilege">FreshPrivilege()<a class="self-link" href="#dom-privilege-freshprivilege"></a></dfn>
      
      
      <dd>
      When invoking the <a data-link-type="functionish" href="#dom-privilege-freshprivilege">FreshPrivilege()</a> constructor, the user
      agent MUST use an algorithm equivalent to the following:


       <ol>
        <li data-md="">
         <p>Let <var>unique Label</var> be the label produced by invoking the
<a data-link-type="functionish" href="#dom-label-label">Label(other)</a> constructor with a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-2.3">globally unique
identifier</a>.</p>
         


        <li data-md="">
         <p>Return a new <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> that has an
<a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> set to <var>unique Label</var>.</p>
         
</ol>
      
    
     </dl>
     

    
     <h4 class="heading settled" data-level="3.2.2" id="methods0"><span class="secno">3.2.2. </span><span class="content">Methods</span><a class="self-link" href="#methods0"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="Privilege" data-dfn-type="method" data-export="" id="dom-privilege-aslabel" title="asLabel()">asLabel()<a class="self-link" href="#dom-privilege-aslabel"></a></dfn>
      
      
      <dd>
      MUST return the <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> of the
      <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> on which the method has been called.
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="Privilege" data-dfn-type="method" data-export="" data-lt="combine(other)" id="dom-privilege-combineother" title="combine(other)">combine(Privilege other)<a class="self-link" href="#dom-privilege-combineother"></a></dfn>
      
      
      <dd>
      MUST return a new <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> whose <a data-link-type="dfn" href="#internal-privilege-label">internal
      privilege label</a> is <a data-link-type="dfn" href="#equivalent">equivalent</a> to a <a data-link-type="dfn" href="#label">label</a>
      created according to an algorithm equivalent to the following:


       <ol>
        <li data-md="">
         <p>Let <var>lintrnal</var> be the
<a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> of the 
<a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> on which the method has been called.</p>
         


        <li data-md="">
         <p>Let <var>lother</var> be the <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> of
the <a class="idl-code" data-link-type="argument" href="#dom-privilege-combineother-other">other</a> argument.</p>
         


        <li data-md="">
         <p>Return <code><var>linternal</var>.<a class="idl-code" data-link-type="method">and</a>(<var>lother</var>)</code>.</p>
         
</ol>
      

      <dt><dfn class="idl-code" data-dfn-for="Privilege" data-dfn-type="method" data-export="" data-lt="delegate(label)" id="dom-privilege-delegatelabel" title="delegate(label)">delegate(Label label)<a class="self-link" href="#dom-privilege-delegatelabel"></a></dfn>
      

      <dd>
MUST return a new <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> whose <a data-link-type="dfn" href="#internal-privilege-label">internal
privilege label</a> is <a data-link-type="dfn" href="#equivalent">equivalent</a> to a <a data-link-type="dfn" href="#label">label</a>
created according to an algorithm equivalent to the following:


       <ol>
        <li data-md="">
         <p>Let <var>linternal</var> be the
<a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> of the 
<a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> on which the method has been called.</p>
         


        <li data-md="">
         <p>Let <var>lother</var> be the <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> of
the <a class="idl-code" data-link-type="argument" href="#dom-privilege-combineother-other">other</a> argument.</p>
         


        <li data-md="">
         <p>Return <code><var>linternal</var>.<a class="idl-code" data-link-type="method">and</a>(<var>lother</var>)</code>.</p>
         
</ol>
      
    
     </dl>
     

    
     <div class="note" role="note">
      Note, the <a class="idl-code" data-link-type="interface" href="#privilege0">Privilege</a> constructors and
      <a data-link-type="functionish" href="#dom-privilege-delegatelabel">delegate()</a> provide a way creating privileges.  Context
      code must still take <a data-link-type="dfn" href="#ownership">ownership</a> of a privilege or set the
      <a data-link-type="dfn" href="#current-privilege">current privilege</a> to it, for the privilege to be used (to
      bypass label restrictions).
    </div>
     

    
     <div class="example" id="example-d36d5a3c"><a class="self-link" href="#example-d36d5a3c"></a>
      To be backwards-compatible with the Same-Origin Policy, COWL
      grants each <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">browsing context</a> a <a data-link-type="dfn">default initial privilege</a>
      that corresponds to their origin. For example, a page on
      <code>https://example.com</code> has a privilege whose <a data-link-type="dfn" href="#internal-privilege-label">internal
      privilege label</a> is
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://example.com")</code>.


      <p>As a result, reading data that is sensitive to
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://example.com")</code> does
      not confine the context. For example, reading a
      <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a> whose confidentiality label is
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://example.com")</code> does
      not restrict the context from communicating—and thus
      accidentally leak that object’s contents—to another origin.
      To prevent such bugs, the author can drop the privilege by
      setting the <a data-link-type="dfn" href="#current-privilege">current privilege</a> to an <a data-link-type="dfn" href="#empty-privilege">empty
      privilege</a>:</p>
      
      
      <pre><code>// Save privilege in case we need it later:
var __savedPriv = COWL.privilege;

// Drop privilege:
COWL.privilege = new <a data-link-type="dfn" href="#privilege">Privilege</a>();
</code></pre>
      


      <p>After this point, if the context reads data with a
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://example.com")</code>
      confidentiality label, COWL will limit it ability to communicate
      with <code>https://example.com")</code>.</p>
      
    
     </div>
     

    
     <div class="example" id="example-94abe9a0"><a class="self-link" href="#example-94abe9a0"></a>
      Consider a modification to <a href="#example-checker">
        password-checker example</a> that uses <a data-link-type="functionish" href="#dom-privilege-freshprivilege">FreshPrivilege()</a>s
      to ensure that the untrusted checker cannot communicate with any
      entity other than the parent context.
      
      <pre><code>// Create new fresh privilege: 
var priv = new <a data-link-type="functionish" href="#dom-privilege-freshprivilege">FreshPrivilege()</a>;

// Take <a data-link-type="dfn" href="#ownership">ownership</a> of the fresh privilege:
COWL.privilege = COWL.privilege.combine(priv);

// Associate the unique label with the password:
var labeldPassword = new <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>(password, {confidentiality: priv.asLabel()});

// Send the labeled password to the checker iframe:
checker.postMessage(labeledPassword, "https://untrusted.com");
</code></pre>
      

      <p>Once the <code>https://untrusted.com</code> context reads the
      password is will be <a data-link-type="dfn" href="#tainted">tainted</a> by the unique, <a data-link-type="dfn" href="#internal-privilege-label">internal
      privilege label</a> of <code>priv</code>; the unique origin
      ensures that it cannot send the password to, for example, public
      parts of <code>https://example.com</code>. Indeed, only the
      owner of <code>priv</code> can disseminate the labeled password
      (result) arbitrarily.</p>
      
    
     </div>
     

    
     <div class="example" id="university-example-js"><a class="self-link" href="#university-example-js"></a>
      Suppose <code>https://university.edu</code> wished to isolate
      different parts of their site, for example, according to the
      users. The author can drop the privilege of a page
      <code>https://university.edu/~user1</code>:

      
      <pre><code lang-js="">var uni = new <a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://university.edu");
// Create a new label that corresponds to user1’s data on university.edu:
var user1 = uni.or("cowl://user1"); // Here the cowl:// is an arbitrary <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-scheme">scheme</a>

// Assume: COWL.privilege.asLabel().equals(uni);
// Drop the current context privilege to a delegated privilege:
COWL.privilege = COWL.privilege.delegate(user1);
</code></pre>
      


      <p>At this point, the context can only arbitrarily disseminate data
      that is labeled
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://university.edu").or("cowl://user1")</code>;
      it cannot disseminate data that is
      sensitive to the university and is thus labeled
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://university.edu")</code>;
      or another user’s data (e.g.,
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://university.edu").or("cowl://user2")</code>).</p>
      


      <p>Of course, this requires the author to properly label user data
      (e.g., when sending it to the client).</p>
      


      <p class="note" role="note">Note, sub-domains should be used where possible to ensure
      isolation. Nevertheless, COWL’s labels can serve as another
      layer of defense.</p>
      


      <p><a href="#examples-isolation">§1.2.3 Content isolation via privilege separation</a> shows how to implement this example
      using the <code>COWL</code> response header.</p>
      
    
     </div>
     

  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="3.3" id="context-labels"><span class="secno">3.3. </span><span class="content">Labeled Contexts and Workers Interface</span><a class="self-link" href="#context-labels"></a></h3>
     


     <p>COWL extends <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">browsing contexts</a> and <a data-link-type="dfn" href="http://www.w3.org/TR/workers/#worker">Workers</a> with a
    corresponding <dfn data-dfn-type="dfn" data-noexport="" id="cowl-state">COWL state<a class="self-link" href="#cowl-state"></a></dfn>, which consists of:</p>
     


     <ul>
      <li data-md="">
       <p>The <dfn data-dfn-type="dfn" data-noexport="" id="confinement-mode">confinement mode<a class="self-link" href="#confinement-mode"></a></dfn> status, which indicates whether
or not COWL is enabled and thus <a data-link-type="dfn" href="#label">labels</a> should be enforced
in the current context.</p>
       


      <li data-md="">
       <p>The <dfn data-dfn-type="dfn" data-noexport="" id="context-confidentiality-label">context confidentiality label<a class="self-link" href="#context-confidentiality-label"></a></dfn>, which reflects
the sensitivity of the data that the context has read, and thus
can write to.</p>
       


      <li data-md="">
       <p>The <dfn data-dfn-type="dfn" data-noexport="" id="context-integrity-label">context integrity label<a class="self-link" href="#context-integrity-label"></a></dfn>, which reflects the
integrity of the data that the context has read, and thus can
write to.</p>
       


      <li data-md="">
       <p>The <dfn data-dfn-type="dfn" data-noexport="" id="context-privilege">context privilege<a class="self-link" href="#context-privilege"></a></dfn>, which encodes the context’s
ability to bypass restrictions of certain labels.</p>
       
</ul>
     

     <p>Each <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#windows">browsing context</a>’s and <a data-link-type="dfn" href="http://www.w3.org/TR/workers/#worker">Worker</a>’s <dfn data-dfn-type="dfn" data-noexport="" id="cowl-state0">COWL
    state<a class="self-link" href="#cowl-state0"></a></dfn> MUST be initially set to the <dfn data-dfn-type="dfn" data-noexport="" id="default-cowl-state">default COWL
    state<a class="self-link" href="#default-cowl-state"></a></dfn>, where:</p>
     


     <ul>
      <li data-md="">
       <p>The <a data-link-type="dfn" href="#confinement-mode">confinement mode</a> is disabled.</p>
       


      <li data-md="">
       <p>The <a data-link-type="dfn" href="#context-confidentiality-label">context confidentiality label</a> is set to the
<dfn data-dfn-type="dfn" data-noexport="" id="default-confidentiality-label">default confidentiality label<a class="self-link" href="#default-confidentiality-label"></a></dfn>: an <a data-link-type="dfn" href="#empty-label">empty label</a>.</p>
       


      <li data-md="">
       <p>The <a data-link-type="dfn" href="#context-integrity-label">context integrity label</a> is set to the
<dfn data-dfn-type="dfn" data-noexport="" id="default-integrity-label">default integrity label<a class="self-link" href="#default-integrity-label"></a></dfn>: an <a data-link-type="dfn" href="#empty-label">empty label</a>.</p>
       


      <li data-md="">
       <p>The <a data-link-type="dfn" href="#context-privilege">context privilege</a> is set to the
<dfn data-dfn-type="dfn" data-noexport="" id="default-privilege">default privilege<a class="self-link" href="#default-privilege"></a></dfn>: a
<a data-link-type="dfn" href="#privilege">privilege</a> whose <a data-link-type="dfn" href="#internal-privilege-label">internal privilege label</a> is
equivalent to <a data-link-type="functionish" href="#dom-label-label">Label(<var>origin</var>)</a>, where
<var>origin</var> is the string representation of the context or
Worker’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>.</p>
       
</ul>
     
    
     <div class="note" role="note">
      To be backwards-compatible with the Same-Origin Policy the
      <a data-link-type="dfn" href="#default-cowl-state">default COWL state</a> is very relaxed. Specifically:


      <ul>
       <li data-md="">
        <p>Unless <a data-link-type="dfn" href="#confinement-mode">confinement mode</a> is enabled, a context is not
subject to label restrictions. (Of course, algorithms such as the
<a data-link-type="dfn" href="#context-tainting">context tainting</a> algorithm implicitly enable confinement
mode.)</p>
        


       <li data-md="">
        <p>Unless the <a data-link-type="dfn">current confidentiality</a> label is
set—explicitly or implicitly via the <a data-link-type="dfn" href="#context-tainting">context tainting</a>
algorithm—to a non-<a data-link-type="dfn" href="#empty-label">empty label</a>, it can communicate to
any context, server or Worker; code is only subject to the
restrictions imposed by other mechanism such as the Same-Origin
Policy, CSP, and CORS.</p>
        


       <li data-md="">
        <p>Unless the <a data-link-type="dfn" href="#current-privilege">current privilege</a> is adjusted, even when
<a data-link-type="dfn" href="#confinement-mode">confinement mode</a> is enabled, code can accidentally leak
data sensitive to the context’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>. Such data is
implicitly declassified using the <a data-link-type="dfn" href="#context-privilege">context privilege</a>.
Authors should always send <a data-link-type="functionish">LabeledObjects()</a> to explicitly
communicate the sensitivity (and integrity) of the data they are
sharing.</p>
        
</ul>
      

      <p class="issue" id="issue-e1bb8a0a"><a class="self-link" href="#issue-e1bb8a0a"></a> for discussion: should privileges be used explicitly
      instead?</p>
      

    
     </div>
     


     <p>Each context and Worker’s <a data-link-type="dfn" href="#cowl-state">COWL state</a> is made available via
    the <a class="idl-code" data-link-type="interface" href="#cowl">COWL</a> interface defined below.</p>
     

    
     <pre class="idl">interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="cowl">COWL<a class="self-link" href="#cowl"></a></dfn> {
  static void <a class="idl-code" data-link-type="method" href="#dom-cowl-enable">enable</a>();
  static boolean <a class="idl-code" data-link-type="method" href="#dom-cowl-isenabled">isEnabled</a>();

  [SetterThrows] static attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-type="Label " href="#dom-cowl-confidentiality">confidentiality</a>;
  [SetterThrows] static attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-type="Label " href="#dom-cowl-integrity">integrity</a>;

  [SetterThrows] static attribute <a data-link-type="idl-name" href="#privilege0">Privilege</a> <a class="idl-code" data-link-type="attribute" data-type="Privilege " href="#dom-cowl-privilege">privilege</a>;
};
</pre>
     

    
     <h4 class="heading settled" data-level="3.3.1" id="attributes"><span class="secno">3.3.1. </span><span class="content">Attributes</span><a class="self-link" href="#attributes"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="COWL" data-dfn-type="attribute" data-export="" id="dom-cowl-confidentiality" title="COWL/confidentiality">confidentiality<a class="self-link" href="#dom-cowl-confidentiality"></a></dfn>, <span> of type <a data-link-type="idl-name" href="#label1">Label</a></span>
      
      
      <dd>

       <ul>
        <li data-md="">
         <p>On getting, the user agent MUST return the <a data-link-type="dfn" href="#current-confidentiality-label">current
confidentiality label</a>.</p>
         


        <li data-md="">
         <p>On setting, the user agent MUST use an algorithm equivalent
to the following:</p>
         


         <ol>
          <li data-md="">
           <p>Enable <a data-link-type="dfn"> confinement mode</a>.</p>
           


          <li data-md="">
           <p>Let <var>conf</var> be the set confidentiality label.</p>
           



          <li data-md="">
           <p>Let <var>canWrite</var> be the result of invoking
the <a data-link-type="dfn" href="#write-check0">write check</a> algorithm with <var>conf</var>
and the <a data-link-type="dfn" href="#current-integrity-label">current integrity label</a>.</p>
           


          <li data-md="">
           <p>If <var>canWrite</var> is <code>false</code>, the user
agent MUST throw a <a data-link-type="dfn">SecurityError</a>
exception and terminate this algorithm.</p>
           


          <li data-md="">
           <p>Else, the user agent MUST set the <a data-link-type="dfn" href="#current-confidentiality-label">current
confidentiality label</a> to <var>conf</var></p>
           
</ol></ul>
       
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="COWL" data-dfn-type="attribute" data-export="" id="dom-cowl-integrity" title="COWL/integrity">integrity<a class="self-link" href="#dom-cowl-integrity"></a></dfn>, <span> of type <a data-link-type="idl-name" href="#label1">Label</a></span>
      
      
      <dd>

       <ul>
        <li data-md="">
         <p>On getting, the user agent MUST return the <a data-link-type="dfn" href="#current-integrity-label">current
integrity label</a>.</p>
         


        <li data-md="">
         <p>On setting, the user agent MUST use an algorithm equivalent
to the following:</p>
         


         <ol>
          <li data-md="">
           <p>Enable <a data-link-type="dfn"> confinement mode</a>.</p>
           


          <li data-md="">
           <p>Let <var>int</var> be the set integrity label.</p>
           


          <li data-md="">
           <p>Let <var>canWrite</var> be the result of invoking the
<a data-link-type="dfn" href="#write-check0">write check</a> algorithm with the <a data-link-type="dfn" href="#current-confidentiality-label">current
confidentiality label</a> and <var>conf</var>.</p>
           


          <li data-md="">
           <p>If <var>canWrite</var> is <code>false</code>, the user
agent MUST throw a <a data-link-type="dfn">SecurityError</a>
exception and terminate this algorithm.</p>
           


          <li data-md="">
           <p>Else, the user agent MUST set the <a data-link-type="dfn" href="#current-integrity-label">current
integrity label</a> to <var>int</var></p>
           
</ol></ul>
       
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="COWL" data-dfn-type="attribute" data-export="" id="dom-cowl-privilege" title="COWL/privilege">privilege<a class="self-link" href="#dom-cowl-privilege"></a></dfn>, <span> of type <a data-link-type="idl-name" href="#privilege0">Privilege</a></span>
      
      
      <dd>

       <ul>
        <li data-md="">
         <p>On getting, the user agent MUST return the <a data-link-type="dfn" href="#current-privilege">current
privilege</a>.</p>
         


        <li data-md="">
         <p>On setting, the user agent MUST enable <a data-link-type="dfn" href="#confinement-mode">confinement mode</a>
and set the <a data-link-type="dfn" href="#current-privilege">current privilege</a> to the set privilege.</p>
         
</ul>
             
      
    
     </dl>
     

    
     <h4 class="heading settled" data-level="3.3.2" id="methods1"><span class="secno">3.3.2. </span><span class="content">Methods</span><a class="self-link" href="#methods1"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="COWL" data-dfn-type="method" data-export="" id="dom-cowl-enable" title="COWL/enable(0">enable()<a class="self-link" href="#dom-cowl-enable"></a></dfn>
      
      
      <dd>
      On invocation, the user agent MUST enable <a data-link-type="dfn" href="#confinement-mode">confinement
      mode</a> by setting the current context’s <a data-link-type="dfn" href="#cowl-state">COWL state</a>
      confinement mode status.
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="COWL" data-dfn-type="method" data-export="" id="dom-cowl-isenabled" title="COWL/isEnabled()">isEnabled()<a class="self-link" href="#dom-cowl-isenabled"></a></dfn>
      
      
      <dd>
        On invocation, the user agent MUST return <code>true</code> if
        the <a data-link-type="dfn" href="#confinement-mode">confinement mode</a> was enabled for the current
        context; else, it MUST return <code>false</code>
      
      
    
     </dl>
     
  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="3.4" id="object-labels"><span class="secno">3.4. </span><span class="content">Labeled Objects Interface</span><a class="self-link" href="#object-labels"></a></h3>
     


     <p>A <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a> interface represents an immutable
    object that has associated with it confidentiality and integrity
    labels.</p>
     


     <p>This API is designed to be used in conjunction with other APIs and
    elements on the web platform. In particular: <a data-link-type="functionish" href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a>,
    <a data-link-type="dfn" href="http://www.w3.org/TR/workers/#web-worker">Web Workers</a>, and <a data-link-type="dfn" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a> (e.g., with an
    overloaded <code>send()</code> method for <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>
    arguments).</p>
     


     <p class="issue" id="issue-05c32959"><a class="self-link" href="#issue-05c32959"></a> receive too..</p>
     


     <p>A <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a> MUST have an internal <dfn data-dfn-type="dfn" data-noexport="" id="protected-object">protected
      object<a class="self-link" href="#protected-object"></a></dfn>, a confidentiality <a data-link-type="dfn" href="#label">label</a>, and an
    integrity <a data-link-type="dfn" href="#label">label</a>.</p>
     

    
     <pre class="idl">dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-cilabel">CILabel<a class="self-link" href="#dictdef-cilabel"></a></dfn> {
  <a data-link-type="idl-name" href="#label1">Label</a>? <dfn class="idl-code" data-dfn-for="CILabel" data-dfn-type="dict-member" data-export="" data-type="Label? " id="dom-cilabel-confidentiality">confidentiality<a class="self-link" href="#dom-cilabel-confidentiality"></a></dfn>;
  <a data-link-type="idl-name" href="#label1">Label</a>? <dfn class="idl-code" data-dfn-for="CILabel" data-dfn-type="dict-member" data-export="" data-type="Label? " id="dom-cilabel-integrity">integrity<a class="self-link" href="#dom-cilabel-integrity"></a></dfn>;
};

[<a class="idl-code" data-link-type="constructor" href="#dom-labeledobject-labeledobjectobj-labels">Constructor</a>(object <dfn class="idl-code" data-dfn-for="LabeledObject/LabeledObject(obj, labels)" data-dfn-type="argument" data-export="" id="dom-labeledobject-labeledobjectobj-labels-obj">obj<a class="self-link" href="#dom-labeledobject-labeledobjectobj-labels-obj"></a></dfn>, <a data-link-type="idl-name" href="#dictdef-cilabel">CILabel</a> <dfn class="idl-code" data-dfn-for="LabeledObject/LabeledObject(obj, labels)" data-dfn-type="argument" data-export="" id="dom-labeledobject-labeledobjectobj-labels-labels">labels<a class="self-link" href="#dom-labeledobject-labeledobjectobj-labels-labels"></a></dfn>)]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="labeledobject">LabeledObject<a class="self-link" href="#labeledobject"></a></dfn> {
  readonly attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="Label " href="#dom-labeledobject-confidentiality">confidentiality</a>;
  readonly attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="Label " href="#dom-labeledobject-integrity">integrity</a>;

  [GetterThrows] readonly attribute object <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="object " href="#dom-labeledobject-protectedobject">protectedObject</a>;

  [Throws] <a data-link-type="idl-name" href="#labeledobject">LabeledObject</a> <dfn class="idl-code" data-dfn-for="LabeledObject" data-dfn-type="method" data-export="" data-lt="clone(newLabels)" id="dom-labeledobject-clonenewlabels">clone<a class="self-link" href="#dom-labeledobject-clonenewlabels"></a></dfn>(<a data-link-type="idl-name" href="#dictdef-cilabel">CILabel</a> <dfn class="idl-code" data-dfn-for="LabeledObject/clone(newLabels)" data-dfn-type="argument" data-export="" id="dom-labeledobject-clonenewlabels-newlabels">newLabels<a class="self-link" href="#dom-labeledobject-clonenewlabels-newlabels"></a></dfn>);
};
</pre>
     
    
     <h4 class="heading settled" data-level="3.4.1" id="constructors1"><span class="secno">3.4.1. </span><span class="content">Constructors</span><a class="self-link" href="#constructors1"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="LabeledObject" data-dfn-type="constructor" data-export="" id="dom-labeledobject-labeledobjectobj-labels">LabeledObject(obj, labels)<a class="self-link" href="#dom-labeledobject-labeledobjectobj-labels"></a></dfn>
      
      
      <dd>


       <p>When invoking the <a data-link-type="functionish" href="#dom-labeledobject-labeledobjectobj-labels">LabeledObject()</a> constructor, the user
      agent MUST use an algorithm equivalent to the following:</p>
       


       <ol>
        <li data-md="">
         <p>Let <var>obj clone</var> be the result of obtaining a
<a data-link-type="dfn" href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structured clone</a> of the <a class="idl-code" data-link-type="argument">protectedObject</a> argument.</p>
         


        <li data-md="">
         <p>Let <var>conf</var> be the <a class="idl-code" data-link-type="dict-member" href="#dom-cilabel-confidentiality">confidentiality</a> member of the <a class="idl-code" data-link-type="argument" href="#dom-labeledobject-labeledobjectobj-labels-labels">labels</a>
argument, if it is set.  Otherwise, let <var>conf</var> be
the <a data-link-type="dfn" href="#current-confidentiality-label">current confidentiality label</a>.</p>
         


        <li data-md="">
         <p>Let <var>int</var> be the <a class="idl-code" data-link-type="dict-member" href="#dom-cilabel-integrity">integrity</a> member of the <a class="idl-code" data-link-type="argument" href="#dom-labeledobject-labeledobjectobj-labels-labels">labels</a>
parameter, if it is set.  Otherwise, let <var>int</var> be the
<a data-link-type="dfn" href="#current-integrity-label">current integrity label</a>.</p>
         


        <li data-md="">
         <p>Let <var>canWrite</var> be the result of invoking the <a data-link-type="dfn" href="#write-check0">write
check</a> algorithm with the <var>conf</var> and <var>int</var> labels.</p>
         


        <li data-md="">
         <p>If <var>canWrite</var> is <code>false</code>, the constructor
MUST throw a <a data-link-type="dfn">SecurityError</a> exception
and terminate this algorithm.</p>
         


        <li data-md="">
         <p>Else, the constructor MUST return a new
<a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>, with the <a data-link-type="dfn" href="#protected-object">protected object</a>
set to <var>obj clone</var>, the confidentiality label set to
<var>conf</var>, and the integrity
label set to <var>int</var>.</p>
         
</ol>
      
    
     </dl>
     

    
     <div class="note" role="note">
      Because COWL enforces labels at context boundaries, there is
      usually no reason to label an object and then use the labeled
      object within the same context.  <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>s
      are mainly useful for sending sensitive data to an untrusted
      context, e.g., via cross-document messaging, as a way to ensure
      that the data’s confidentiality and integrity (as specified by
      the labels) are respected by the untrusted context. Hence, the
      <a data-link-type="functionish" href="#dom-labeledobject-labeledobjectobj-labels">LabeledObject()</a> constructor only accepts objects that can
      be <a data-link-type="dfn" href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structurally cloned</a>.
    </div>
     

    
     <h4 class="heading settled" data-level="3.4.2" id="attributes0"><span class="secno">3.4.2. </span><span class="content">Attributes</span><a class="self-link" href="#attributes0"></a></h4>
     
    
     <dl>
      
      <dt><dfn class="idl-code" data-dfn-for="LabeledObject" data-dfn-type="attribute" data-export="" id="dom-labeledobject-confidentiality" title="LabeledObject/confidentiality">confidentiality<a class="self-link" href="#dom-labeledobject-confidentiality"></a></dfn>, <span> of type <a data-link-type="idl-name" href="#label1">Label</a>, readonly</span>
      
      
      <dd>
        On getting, the user agent MUST return the <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>’s confidentiality label.
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="LabeledObject" data-dfn-type="attribute" data-export="" id="dom-labeledobject-integrity" title="LabeledObject/integrity">integrity<a class="self-link" href="#dom-labeledobject-integrity"></a></dfn>, <span> of type <a data-link-type="idl-name" href="#label1">Label</a>, readonly</span>
      
      
      <dd>
        On getting, the user agent MUST return the <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>’s integrity label.
      
      
      
      <dt><dfn class="idl-code" data-dfn-for="LabeledObject" data-dfn-type="attribute" data-export="" id="dom-labeledobject-protectedobject" title="LabeledObject/protectedObject">protectedObject<a class="self-link" href="#dom-labeledobject-protectedobject"></a></dfn>, <span> of type <a data-link-type="idl-name">object</a>, readonly</span>
      
      
      <dd>
        On getting, the user agent MUST use an algorithm equivalent to
        the following:


       <ol>
        <li data-md="">
         <p>Invoke the <a data-link-type="dfn" href="#context-tainting">context tainting</a> algorithm with the <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>’s confidentiality and integrity labels.</p>
         


        <li data-md="">
         <p>If the <a data-link-type="dfn" href="#context-tainting">context tainting</a> algorithm raises an
exception, rethrow the exception and terminate this algorithm.</p>
         


        <li data-md="">
         <p>Return the <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a>’s <a data-link-type="dfn" href="#protected-object">protected
object</a>.</p>
         
</ol>
             
      
    
     </dl>
     

    
     <div class="note" role="note">
      Note: the labels of a <a class="idl-code" data-link-type="interface" href="#labeledobject">LabeledObject</a> are
      essentially public: code can always inspect labels. However, to
      inspect the internal, <a data-link-type="dfn" href="#protected-object">protected object</a> the current
      context must be tainted according to the object’s labels. This
      ensures two things:


      <ul>
       <li data-md="">
        <p>The context can’t violate the confidentiality of the data (as
specified by the confidentiality label) by communicating
arbitrarily once it reads data labeled as such.</p>
        


       <li data-md="">
        <p>The context can’t violate the integrity of entities more
trustworthy than the data. (The trustworthiness of the data is
specified by the integrity label.) In particular, once the
context reads the data and gets tainted, the rest of the
computation is restricted to writing to entities that are at
most as trustworthy as the data, for the read data may have
influenced the computation.</p>
        
</ul>
          
     </div>
     

    
     <h4 class="heading settled" data-level="3.4.3" id="methods2"><span class="secno">3.4.3. </span><span class="content">Methods</span><a class="self-link" href="#methods2"></a></h4>
     


     <p class="issue" id="issue-8d80fc2e"><a class="self-link" href="#issue-8d80fc2e"></a> describe <code>clone</code></p>
     

    
     <h4 class="heading settled" data-level="3.4.4" id="extensions-to-xmlhttprequest"><span class="secno">3.4.4. </span><span class="content">Extensions to <a data-link-type="dfn" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></span><a class="self-link" href="#extensions-to-xmlhttprequest"></a></h4>
     

    
     <h5 class="heading settled" data-level="3.4.4.1" id="request"><span class="secno">3.4.4.1. </span><span class="content">Request</span><a class="self-link" href="#request"></a></h5>
     
      This specification extends the
      <a class="idl-code" data-link-type="interface" href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a> interface with and overloaded
      <a href="https://xhr.spec.whatwg.org/#the-send()-method">send()</a>
      method:

      
     <pre class="idl">partial interface <a class="idl-code" data-link-type="interface" href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a> {
  void <a class="idl-code" data-link-type="method" href="#dom-xmlhttprequest-sendlobj">send</a>(<a data-link-type="idl-name" href="#labeledobject">LabeledObject</a> <dfn class="idl-code" data-dfn-for="XMLHttpRequest/send(lobj)" data-dfn-type="argument" data-export="" id="dom-xmlhttprequest-sendlobj-lobj">lobj<a class="self-link" href="#dom-xmlhttprequest-sendlobj-lobj"></a></dfn>);
};
</pre>
     

     <p>The <dfn class="idl-code" data-dfn-for="XMLHttpRequest" data-dfn-type="method" data-export="" id="dom-xmlhttprequest-sendlobj" title="XMLHttpRequest/send(lobj)">send(lobj)<a class="self-link" href="#dom-xmlhttprequest-sendlobj"></a></dfn>  method must run these steps:</p>
     


     <ol>
      <li data-md="">
       <p>Let <var>obj</var> be the serialized object produced by
invoking the <a data-link-type="dfn" href="#labeledobject-serialization">LabeledObject serialization</a> algorithm with
the <a class="idl-code" data-link-type="argument" href="#dom-xmlhttprequest-sendlobj-lobj">lobj</a>
argument.</p>
       


      <li data-md="">
       <p>Call the
<a href="https://xhr.spec.whatwg.org/#the-send()-method">send()</a>
method on the object this method was called on with 
<var>obj</var> as an argument.</p>
       
</ol>
     

     <p class="issue" id="issue-8e9dcf2b"><a class="self-link" href="#issue-8e9dcf2b"></a> send() is not well-defined. Should we only allow JSON
      objects for LabeldObject? Or should we have a header associated
      with object and use normal serialization?</p>
     


    
     <h5 class="heading settled" data-level="3.4.4.2" id="response"><span class="secno">3.4.4.2. </span><span class="content">Response</span><a class="self-link" href="#response"></a></h5>
     
      This specification extends the
      <code><a class="idl-code" data-link-type="enum" href="https://xhr.spec.whatwg.org/#xmlhttprequestresponsetype">XMLHttpRequestResponseType</a></code> with a new
      response type:
      
     <pre class="idl">enum XMLHttpRequestResponseType {
  ... existing response types ...,
  "labeled-text"
};
</pre>
     


     <p class="issue" id="issue-3f45d629"><a class="self-link" href="#issue-3f45d629"></a> Should we have labeld-json, labeled-blob, etc.?</p>
     


     <p class="issue" id="issue-656b48b1"><a class="self-link" href="#issue-656b48b1"></a> completed definition for XHR response.</p>
     

  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="3.5" id="response-header"><span class="secno">3.5. </span><span class="content">The <code>COWL</code> HTTP Response Header Field</span><a class="self-link" href="#response-header"></a></h3>
     


     <p class="issue" id="issue-e30b85a5"><a class="self-link" href="#issue-e30b85a5"></a> describe response header grammar</p>
     


     <p class="issue" id="issue-f4bc3b24"><a class="self-link" href="#issue-f4bc3b24"></a> describe how response header is processes</p>
     


     <p class="issue" id="issue-8027d210"><a class="self-link" href="#issue-8027d210"></a> describe how labeled headers and XHR work</p>
     

    
     <div class="example" id="example-cccc17f6"><a class="self-link" href="#example-cccc17f6"></a>
      The author of <code>http://a.com</code> may wish to reply to a 
      request with data that is sensitive to both <code>https://a.com</code> and
      <a data-link-type="dfn">https://b.com</a>, while simultaneously indicating that
      it endorses the data:
      
      <pre><code>COWL: <a data-link-type="dfn">confidentiality-label</a> [ ['https://a.com'], ['https://b.com'] ];
      <a data-link-type="dfn">integrity-label</a> [ ['https://a.com'] ];
</code></pre>
      
    
     </div>
     
    
     <div class="example" id="example-af83b2df"><a class="self-link" href="#example-af83b2df"></a>
      An author may wish to specify that the
      <code>https://university.edu/~user1</code> page should run with
      a delegated privilege—namely, 
      <code><a class="idl-code" data-link-type="interface" href="#label1">Label</a>("https://university.edu/").or("cowl://user1")</code>—from
       the start:
      
      <pre><code>COWL: <a data-link-type="dfn" href="#privilege">privilege</a> [ ['self', 'cowl://user1'] ];
</code></pre>
      
    
     </div>
     
  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="3.6" id="request-header"><span class="secno">3.6. </span><span class="content">The <code>COWL</code> HTTP Request Header Field</span><a class="self-link" href="#request-header"></a></h3>
     
    The user agent MUST send a header field named <dfn data-dfn-type="dfn" data-local-lt="COWL" data-noexport="" id="cowl0"><code>COWL</code><a class="self-link" href="#cowl0"></a></dfn>
    along with requests if <a data-link-type="dfn" href="#confinement-mode">confinement mode</a> is enabled.
    The value of this header MUST contain the
    stringyfied context’s <a data-link-type="dfn" href="#current-confidentiality-label">current confidentiality label</a>,
    <a data-link-type="dfn" href="#current-integrity-label">current integrity label</a>, and <a data-link-type="dfn" href="#current-privilege">current privilege</a>, as
    defined by the following ABNF grammar:


     <p class="issue" id="issue-1d09bad5"><a class="self-link" href="#issue-1d09bad5"></a> describe request header grammar</p>
     

    
     <div class="example" id="example-d074badb"><a class="self-link" href="#example-d074badb"></a>
      Request header from an <code>http://a.com</code> context that has
      read data sensitive to <code>http://b.com</code>.
      
      <pre><code>COWL: <a data-link-type="dfn">confidentiality-label</a> [ ['https://b.com'] ];
      <a data-link-type="dfn">integrity-label</a> [ [] ];
      <a data-link-type="dfn" href="#privilege">privilege</a> [ ['https://a.com'] ];
</code></pre>
      
    
     </div>
     
    
     <div class="example" id="example-7e38bf47"><a class="self-link" href="#example-7e38bf47"></a>
      Request header from a public, untrustworthy
      <code>http://university.edu</code> context that owns a
      delegated privilege:
      
      <pre><code>COWL: <a data-link-type="dfn">confidentiality-label</a> [ [] ];
      <a data-link-type="dfn">integrity-label</a> [ [] ];
      <a data-link-type="dfn" href="#privilege">privilege</a> [ ['http://university.edu', 'cowl://user1'] ];
</code></pre>
      
    
     </div>
     
  
    </section>

</section>



   <section>
  
    <h2 class="heading settled" data-level="4" id="lworkers"><span class="secno">4. </span><span class="content">Light-weight Workers</span><a class="self-link" href="#lworkers"></a></h2>

  
    <pre class="idl">[<dfn class="idl-code" data-dfn-for="LWorker" data-dfn-type="constructor" data-export="" data-lt="LWorker(scriptURL, initState)" id="dom-lworker-lworkerscripturl-initstate">Constructor<a class="self-link" href="#dom-lworker-lworkerscripturl-initstate"></a></dfn>(DOMString <dfn class="idl-code" data-dfn-for="LWorker/LWorker(scriptURL, initState)" data-dfn-type="argument" data-export="" id="dom-lworker-lworkerscripturl-initstate-scripturl">scriptURL<a class="self-link" href="#dom-lworker-lworkerscripturl-initstate-scripturl"></a></dfn>, <a data-link-type="idl-name">InitCOWLstate</a>? <dfn class="idl-code" data-dfn-for="LWorker/LWorker(scriptURL, initState)" data-dfn-type="argument" data-export="" id="dom-lworker-lworkerscripturl-initstate-initstate">initState<a class="self-link" href="#dom-lworker-lworkerscripturl-initstate-initstate"></a></dfn>)]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="lworker">LWorker<a class="self-link" href="#lworker"></a></dfn> : <a data-link-type="idl-name" href="http://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  void <dfn class="idl-code" data-dfn-for="LWorker" data-dfn-type="method" data-export="" data-lt="postMessage(message)" id="dom-lworker-postmessagemessage">postMessage<a class="self-link" href="#dom-lworker-postmessagemessage"></a></dfn>(any <dfn class="idl-code" data-dfn-for="LWorker/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-lworker-postmessagemessage-message">message<a class="self-link" href="#dom-lworker-postmessagemessage-message"></a></dfn>);
  [TreatNonCallableAsNull] attribute <a data-link-type="idl-name">Function</a>? <dfn class="idl-code" data-dfn-for="LWorker" data-dfn-type="attribute" data-export="" data-type="Function? " id="dom-lworker-onmessage">onmessage<a class="self-link" href="#dom-lworker-onmessage"></a></dfn>;
}
</pre>


    <p class="issue" id="issue-1a34a695"><a class="self-link" href="#issue-1a34a695"></a> describe worker interface</p>

  
    <h3 class="heading settled" data-level="4.1" id="lworker-global"><span class="secno">4.1. </span><span class="content">The <a data-link-type="dfn">LWorkerGlobalScope</a> interface</span><a class="self-link" href="#lworker-global"></a></h3>

  
    <pre class="idl">interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="lworkerglobalscope">LWorkerGlobalScope<a class="self-link" href="#lworkerglobalscope"></a></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a> {
};
</pre>


    <p class="issue" id="issue-b4d466bf"><a class="self-link" href="#issue-b4d466bf"></a> describe worker global</p>


</section>




   <section>
  
    <h2 class="heading settled" data-level="5" id="algorithms"><span class="secno">5. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
  
    <section>
    
     <h3 class="heading settled" data-level="5.1" id="reduce-to-normal-form"><span class="secno">5.1. </span><span class="content">Label Normal Form Reduction</span><a class="self-link" href="#reduce-to-normal-form"></a></h3>
     
    The <dfn data-dfn-type="dfn" data-noexport="" id="label-normal-form-reduction">label normal form reduction<a class="self-link" href="#label-normal-form-reduction"></a></dfn> algorithm takes a
    <var>label</var> argument and produces a <a data-link-type="dfn" href="#label">Label</a> value
    according to the following steps:


     <p class="issue" id="issue-a82506bb"><a class="self-link" href="#issue-a82506bb"></a> describe the reduction algorithm</p>
     

  
    </section>
  
    <section>
    
     <h3 class="heading settled" data-level="5.2" id="subsumes-check"><span class="secno">5.2. </span><span class="content">Label Subsumption</span><a class="self-link" href="#subsumes-check"></a></h3>
     
    The <dfn data-dfn-type="dfn" data-noexport="" id="label-subsumption">label subsumption<a class="self-link" href="#label-subsumption"></a></dfn> algorithm takes a two labels
    <var>A</var> and <var>B</var> and produces a boolean according to
    these steps:


     <p class="issue" id="issue-3dc7e411"><a class="self-link" href="#issue-3dc7e411"></a> describe the subsumes algorithm</p>
     

  
    </section>
  
    <section>
    
     <h3 class="heading settled" data-level="5.3" id="label-reduce"><span class="secno">5.3. </span><span class="content">Label Downgrade</span><a class="self-link" href="#label-reduce"></a></h3>
     
    The <dfn data-dfn-type="dfn" data-noexport="" id="label-downgrade">label downgrade<a class="self-link" href="#label-downgrade"></a></dfn> algorithm takes a label,
    <var>label</var> and a privilege<var>priv</var>, and returns
    the least restricting label according to the following steps:


     <p class="issue" id="issue-c98f93fc"><a class="self-link" href="#issue-c98f93fc"></a> describe downgrade</p>
     

  
    </section>
  
    <section>
    
     <h3 class="heading settled" data-level="5.4" id="taint-context"><span class="secno">5.4. </span><span class="content">Context Tainting</span><a class="self-link" href="#taint-context"></a></h3>
     
    The <dfn data-dfn-type="dfn" data-noexport="" id="context-tainting">context tainting<a class="self-link" href="#context-tainting"></a></dfn> algorithm takes a two labels,
    <var>confidentiality</var> and <var>integrity</var>, and updates
    the <a data-link-type="dfn">context labels</a> to allow for reading data labeled with
    these labels.


     <p class="issue" id="issue-9c43f37a"><a class="self-link" href="#issue-9c43f37a"></a> describe taint</p>
     


  
    </section>
  
    <section>
    
     <h3 class="heading settled" data-level="5.5" id="write-check"><span class="secno">5.5. </span><span class="content">Write Check</span><a class="self-link" href="#write-check"></a></h3>
     
    The <dfn data-dfn-type="dfn" data-noexport="" id="write-check0">write check<a class="self-link" href="#write-check0"></a></dfn> algorithm takes a two labels,
    <var>confidentiality</var> and <var>integrity</var>, and returns
    <code>true</code> if the current context is allowed to write to
    (or create) an entity labeled as such; otherwise, it returns
    <code>false</code>.


     <p class="issue" id="issue-821539a6"><a class="self-link" href="#issue-821539a6"></a> describe write check</p>
     

  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="5.6" id="labeldobject-serialization"><span class="secno">5.6. </span><span class="content">Serializing Labeld Objects</span><a class="self-link" href="#labeldobject-serialization"></a></h3>
     
    The <dfn data-dfn-type="dfn" data-noexport="" id="labeledobject-serialization">LabeledObject serialization<a class="self-link" href="#labeledobject-serialization"></a></dfn> algorithm takes a <a class="idl-code" data-link-type="interface">LabeldObject</a> and returns a serialized version of
      it.


     <p class="issue" id="issue-a91b62a7"><a class="self-link" href="#issue-a91b62a7"></a> describe LabeldObject serialization</p>
     

    </section>


    <p class="issue" id="issue-19556c70"><a class="self-link" href="#issue-19556c70"></a> most of the spec talks about contexts not at all about
    workers; should revise to be more general. (Should mostly be
    straightforward.)</p>

</section></main>

  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>


  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>

    
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>

    
  <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    </p>
  <div class="example" id="example-f839f6c8"><a class="self-link" href="#example-f839f6c8"></a>
        
   <p>This is an example of an informative example.</p>
   
    
  </div>

    
  <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    </p>
  <p class="note" role="note">Note, this is an informative note.</p>


  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>

    
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>

    
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>


  <h3 class="no-ref no-num heading settled" id="conformance-classes"><span class="content">Conformance Classes</span><a class="self-link" href="#conformance-classes"></a></h3>

    
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-user-agent">conformant user agent<a class="self-link" href="#conformant-user-agent"></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>

    
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-server">conformant server<a class="self-link" href="#conformant-server"></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>




  <h2 class="no-num heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="indexlist">
   <li>and((Label or DOMString) other), <a href="#dom-label-andlabel-or-domstring-other">3.1.2</a>
   <li>and(other), <a href="#dom-label-andother">3.1</a>
   <li>asLabel(), <a href="#dom-privilege-aslabel">3.2.2</a>
   <li>CILabel, <a href="#dictdef-cilabel">3.4</a>
   <li>clone(newLabels), <a href="#dom-labeledobject-clonenewlabels">3.4</a>
   <li>combination, <a href="#combination">3.2</a>
   <li>combine(other), <a href="#dom-privilege-combineother">3.2.2</a>
   <li>confidentiality
    <ul>
     <li>attribute for COWL, <a href="#dom-cowl-confidentiality">3.3.1</a>
     <li>dict-member for CILabel, <a href="#dom-cilabel-confidentiality">3.4</a>
     <li>attribute for LabeledObject, <a href="#dom-labeledobject-confidentiality">3.4.2</a>
    </ul>
   <li>confinement mode, <a href="#confinement-mode">3.3</a>
   <li>conformant server, <a href="#conformant-server">Unnumbered section</a>
   <li>conformant user agent, <a href="#conformant-user-agent">Unnumbered section</a>
   <li>context confidentiality label, <a href="#context-confidentiality-label">3.3</a>
   <li>context integrity label, <a href="#context-integrity-label">3.3</a>
   <li>context privilege, <a href="#context-privilege">3.3</a>
   <li>context tainting, <a href="#context-tainting">5.4</a>
   <li>COWL
    <ul>
     <li>(interface), <a href="#cowl">3.3</a>
     <li>definition of, <a href="#cowl0">3.6</a>
     <li>definition of, <a href="#cowl0">3.6</a>
    </ul>
   <li>COWL
    state, <a href="#cowl-state0">3.3</a>
   <li>COWL state, <a href="#cowl-state">3.3</a>
   <li>current confidentiality label, <a href="#current-confidentiality-label">2.1</a>
   <li>current integrity label, <a href="#current-integrity-label">2.1</a>
   <li>current privilege, <a href="#current-privilege">2.2</a>
   <li>default confidentiality label, <a href="#default-confidentiality-label">3.3</a>
   <li>default COWL
    state, <a href="#default-cowl-state">3.3</a>
   <li>default integrity label, <a href="#default-integrity-label">3.3</a>
   <li>default privilege, <a href="#default-privilege">3.3</a>
   <li>delegated
      privilege, <a href="#delegated-privilege">3.2</a>
   <li>delegate(label), <a href="#dom-privilege-delegatelabel">3.2.2</a>
   <li>disjunction set, <a href="#disjunction-set">3.1</a>
   <li>dropping privileges, <a href="#dropping-privileges">3.2</a>
   <li>effective confidentiality label, <a href="#effective-confidentiality-label">2.2</a>
   <li>effective integrity label, <a href="#effective-integrity-label">2.2</a>
   <li>empty label, <a href="#empty-label">3.1</a>
   <li>empty privilege, <a href="#empty-privilege">3.2</a>
   <li>enable(), <a href="#dom-cowl-enable">3.3.2</a>
   <li>equals(other), <a href="#dom-label-equalsother">3.1.2</a>
   <li>equivalent, <a href="#equivalent">2.1</a>
   <li>FreshPrivilege(), <a href="#dom-privilege-freshprivilege">3.2.1</a>
   <li>fromJSON(obj), <a href="#dom-label-fromjsonobj">3.1</a>
   <li>initState, <a href="#dom-lworker-lworkerscripturl-initstate-initstate">4</a>
   <li>integrity
    <ul>
     <li>attribute for COWL, <a href="#dom-cowl-integrity">3.3.1</a>
     <li>dict-member for CILabel, <a href="#dom-cilabel-integrity">3.4</a>
     <li>attribute for LabeledObject, <a href="#dom-labeledobject-integrity">3.4.2</a>
    </ul>
   <li>internal privilege
    label, <a href="#internal-privilege-label">3.2</a>
   <li>isEnabled(), <a href="#dom-cowl-isenabled">3.3.2</a>
   <li>Label(), <a href="#dom-label-label">3.1.1</a>
   <li>Label, <a href="#label1">3.1</a>
   <li>label
    <ul>
     <li>definition of, <a href="#label">2.1</a>
     <li>argument for Privilege/delegate(label), <a href="#dom-privilege-delegatelabel-label">3.2</a>
    </ul>
   <li>label downgrade, <a href="#label-downgrade">5.3</a>
   <li>LabeledObject, <a href="#labeledobject">3.4</a>
   <li>LabeledObject(obj, labels), <a href="#dom-labeledobject-labeledobjectobj-labels">3.4.1</a>
   <li>labeled objects, <a href="#labeled-objects">2.1</a>
   <li>LabeledObject serialization, <a href="#labeledobject-serialization">5.6</a>
   <li>label normal form reduction, <a href="#label-normal-form-reduction">5.1</a>
   <li>Label(origin), <a href="#dom-label-labelorigin">3.1.1</a>
   <li>labels, <a href="#dom-labeledobject-labeledobjectobj-labels-labels">3.4</a>
   <li>label set, <a href="#label-set">3.1</a>
   <li>label subsumption, <a href="#label-subsumption">5.2</a>
   <li>lobj, <a href="#dom-xmlhttprequest-sendlobj-lobj">3.4.4.1</a>
   <li>LWorker, <a href="#lworker">4</a>
   <li>LWorkerGlobalScope, <a href="#lworkerglobalscope">4.1</a>
   <li>LWorker(scriptURL, initState), <a href="#dom-lworker-lworkerscripturl-initstate">4</a>
   <li>message, <a href="#dom-lworker-postmessagemessage-message">4</a>
   <li>newLabels, <a href="#dom-labeledobject-clonenewlabels-newlabels">3.4</a>
   <li>normal form, <a href="#normal-form">2.1</a>
   <li>obj
    <ul>
     <li>argument for Label/fromJSON(obj), <a href="#dom-label-fromjsonobj-obj">3.1</a>
     <li>argument for LabeledObject/LabeledObject(obj, labels), <a href="#dom-labeledobject-labeledobjectobj-labels-obj">3.4</a>
    </ul>
   <li>onmessage, <a href="#dom-lworker-onmessage">4</a>
   <li>origin, <a href="#dom-label-labelorigin-origin">3.1</a>
   <li>origin label, <a href="#origin-label">2.1</a>
   <li>_or((Label or DOMString) other), <a href="#dom-label-_orlabel-or-domstring-other">3.1.2</a>
   <li>_or(other), <a href="#dom-label-_orother">3.1</a>
   <li>other
    <ul>
     <li>argument for Label/equals(other), <a href="#dom-label-equalsother-other">3.1</a>
     <li>argument for Label/subsumes(other), <a href="#dom-label-subsumesother-other">3.1</a>
     <li>argument for Label/and(other), <a href="#dom-label-andother-other">3.1</a>
     <li>argument for Label/_or(other), <a href="#dom-label-_orother-other">3.1</a>
     <li>argument for Privilege/combine(other), <a href="#dom-privilege-combineother-other">3.2</a>
    </ul>
   <li>ownership, <a href="#ownership">2.2</a>
   <li>postMessage(message), <a href="#dom-lworker-postmessagemessage">4</a>
   <li>Privilege, <a href="#privilege0">3.2</a>
   <li>privilege
    <ul>
     <li>definition of, <a href="#privilege">2.2</a>
     <li>attribute for COWL, <a href="#dom-cowl-privilege">3.3.1</a>
    </ul>
   <li>Privilege(), <a href="#dom-privilege-privilege">3.2.1</a>
   <li>protectedObject, <a href="#dom-labeledobject-protectedobject">3.4.2</a>
   <li>protected
      object, <a href="#protected-object">3.4</a>
   <li>restricting, <a href="#restricting">2.1</a>
   <li>scriptURL, <a href="#dom-lworker-lworkerscripturl-initstate-scripturl">4</a>
   <li>send(lobj), <a href="#dom-xmlhttprequest-sendlobj">3.4.4.1</a>
   <li>subsumes, <a href="#subsumes">2.1</a>
   <li>subsumes(other), <a href="#dom-label-subsumesother">3.1.2</a>
   <li>tainted, <a href="#tainted">2.1</a>
   <li>toJSON(), <a href="#dom-label-tojson">3.1</a>
   <li>unprivileged, <a href="#unprivileged">3.2</a>
   <li>write check, <a href="#write-check0">5.5</a></ul>
  <h3 class="no-num heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="indexlist">
   <li><a data-link-type="biblio" href="#biblio-cors">[cors]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/cors/#access-control-allow-origin-response-header">access-control-allow-origin</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-html5">[html5]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#windows">browsing context</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#windows">context</a>
     <li><a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-iframe-element">iframe</a>
     <li><a href="http://www.w3.org/TR/html5/embedded-content-0.html#attr-iframe-sandbox">sandbox</a>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structurally clonable</a>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structurally cloned</a>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structured clone</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-rfc6454">[RFC6454]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-2.3">globally unique identifier</a>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-url">[URL]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/url/#concept-url-scheme">scheme</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-webmessaging">[webmessaging]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-workers">[workers]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/workers/#web-worker">web worker</a>
     <li><a href="http://www.w3.org/TR/workers/#worker">worker</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-xhr">[XHR]</a> defines the following terms:
    <ul>
     <li><a href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a>
     <li><a href="https://xhr.spec.whatwg.org/#xmlhttprequestresponsetype">XMLHttpRequestResponseType</a>
     <li><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">xmlhttprequest</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-dom-ls">[dom-ls]</a> defines the following terms:
    <ul>
     <li><a href="http://dom.spec.whatwg.org/#eventtarget">EventTarget</a>
     <li><a href="http://dom.spec.whatwg.org/#concept-document-url">url</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-html">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a>
    </ul></ul>
  <h2 class="no-num heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-ecma-262"><a class="self-link" href="#biblio-ecma-262"></a>[ECMA-262]
   <dd>Allen Wirfs-Brock. <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMA-262 6th Edition, The ECMAScript 2015 Language Specification</a>. June 2015. Standard. URL: <a href="http://www.ecma-international.org/ecma-262/6.0/">http://www.ecma-international.org/ecma-262/6.0/</a>
   <dt id="biblio-html"><a class="self-link" href="#biblio-html"></a>[HTML]
   <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc6454"><a class="self-link" href="#biblio-rfc6454"></a>[RFC6454]
   <dd>Adam Barth. <a href="http://www.ietf.org/rfc/rfc6454.txt">The Web Origin Concept</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc6454.txt">http://www.ietf.org/rfc/rfc6454.txt</a>
   <dt id="biblio-url"><a class="self-link" href="#biblio-url"></a>[URL]
   <dd>Anne van Kesteren; Sam Ruby. <a href="http://www.w3.org/TR/url">URL</a>. WD. URL: <a href="http://www.w3.org/TR/url">http://www.w3.org/TR/url</a>
   <dt id="biblio-xhr"><a class="self-link" href="#biblio-xhr"></a>[XHR]
   <dd>Anne van Kesteren. <a href="https://xhr.spec.whatwg.org/">XMLHttpRequest Standard</a>. Living Standard. URL: <a href="https://xhr.spec.whatwg.org/">https://xhr.spec.whatwg.org/</a>
   <dt id="biblio-cors"><a class="self-link" href="#biblio-cors"></a>[CORS]
   <dd>Anne van Kesteren. <a href="http://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a>. 16 January 2014. REC. URL: <a href="http://www.w3.org/TR/cors/">http://www.w3.org/TR/cors/</a>
   <dt id="biblio-dom-ls"><a class="self-link" href="#biblio-dom-ls"></a>[DOM-LS]
   <dd>Document Object Model URL: <a href="http://dom.spec.whatwg.org/">http://dom.spec.whatwg.org/</a>
   <dt id="biblio-html5"><a class="self-link" href="#biblio-html5"></a>[HTML5]
   <dd>Ian Hickson; et al. <a href="http://www.w3.org/TR/html5/">HTML5</a>. 28 October 2014. REC. URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a>
   <dt id="biblio-rfc2119"><a class="self-link" href="#biblio-rfc2119"></a>[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-webmessaging"><a class="self-link" href="#biblio-webmessaging"></a>[WEBMESSAGING]
   <dd>Ian Hickson. <a href="http://www.w3.org/TR/webmessaging/">HTML5 Web Messaging</a>. 19 May 2015. REC. URL: <a href="http://www.w3.org/TR/webmessaging/">http://www.w3.org/TR/webmessaging/</a>
   <dt id="biblio-workers"><a class="self-link" href="#biblio-workers"></a>[WORKERS]
   <dd>Ian Hickson. <a href="http://www.w3.org/TR/workers/">Web Workers</a>. 1 May 2012. CR. URL: <a href="http://www.w3.org/TR/workers/">http://www.w3.org/TR/workers/</a></dl>
  <h3 class="no-num heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-cowl-osdi"><a class="self-link" href="#biblio-cowl-osdi"></a>[COWL-OSDI]
   <dd>Deian Stefan; et al. <a href="https://www.usenix.org/system/files/conference/osdi14/osdi14-paper-stefan.pdf">Protecting Users by Confining JavaScript with COWL</a>. URL: <a href="https://www.usenix.org/system/files/conference/osdi14/osdi14-paper-stefan.pdf">https://www.usenix.org/system/files/conference/osdi14/osdi14-paper-stefan.pdf</a>
   <dt id="biblio-dclabels"><a class="self-link" href="#biblio-dclabels"></a>[DCLabels]
   <dd>Deian Stefan; et al. <a href="http://www.scs.stanford.edu/~deian/pubs/stefan:2011:dclabels.pdf">Disjunction Category Labels</a>. URL: <a href="http://www.scs.stanford.edu/~deian/pubs/stefan:2011:dclabels.pdf">http://www.scs.stanford.edu/~deian/pubs/stefan:2011:dclabels.pdf</a></dl>
  <h2 class="no-num heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
  <pre class="idl">[<a class="idl-code" data-link-type="constructor" href="#dom-label-label">Constructor</a>, <a class="idl-code" data-link-type="constructor" href="#dom-label-labelorigin">Constructor</a>(DOMString <a href="#dom-label-labelorigin-origin">origin</a>)]
interface <a href="#label1">Label</a> {
  boolean <a class="idl-code" data-link-type="method" href="#dom-label-equalsother">equals</a>(<a data-link-type="idl-name" href="#label1">Label</a> <a href="#dom-label-equalsother-other">other</a>);
  boolean <a class="idl-code" data-link-type="method" href="#dom-label-subsumesother">subsumes</a>(<a data-link-type="idl-name" href="#label1">Label</a> <a href="#dom-label-subsumesother-other">other</a>);

  <a data-link-type="idl-name" href="#label1">Label</a> <a href="#dom-label-andother">and</a>((<a data-link-type="idl-name" href="#label1">Label</a> or DOMString) <a href="#dom-label-andother-other">other</a>);
  <a data-link-type="idl-name" href="#label1">Label</a> <a href="#dom-label-_orother">_or</a>((<a data-link-type="idl-name" href="#label1">Label</a> or DOMString) <a href="#dom-label-_orother-other">other</a>);

  object <a href="#dom-label-tojson">toJSON</a>();
  [Throws] static <a data-link-type="idl-name" href="#label1">Label</a> <a href="#dom-label-fromjsonobj">fromJSON</a>(object <a href="#dom-label-fromjsonobj-obj">obj</a>);
};

[<a class="idl-code" data-link-type="constructor" href="#dom-privilege-privilege">Constructor</a>, <a class="idl-code" data-link-type="constructor" href="#dom-privilege-freshprivilege">NamedConstructor</a>=<a data-link-type="idl-name">FreshPrivilege</a>]
interface <a href="#privilege0">Privilege</a> {
  <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="method" href="#dom-privilege-aslabel">asLabel</a>();

  <a data-link-type="idl-name" href="#privilege0">Privilege</a> <a class="idl-code" data-link-type="method" href="#dom-privilege-combineother">combine</a>(<a data-link-type="idl-name" href="#privilege0">Privilege</a> <a href="#dom-privilege-combineother-other">other</a>);
  [Throws] <a data-link-type="idl-name" href="#privilege0">Privilege</a> <a class="idl-code" data-link-type="method" href="#dom-privilege-delegatelabel">delegate</a>(<a data-link-type="idl-name" href="#label1">Label</a> <a href="#dom-privilege-delegatelabel-label">label</a>);
};

interface <a href="#cowl">COWL</a> {
  static void <a class="idl-code" data-link-type="method" href="#dom-cowl-enable">enable</a>();
  static boolean <a class="idl-code" data-link-type="method" href="#dom-cowl-isenabled">isEnabled</a>();

  [SetterThrows] static attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-type="Label " href="#dom-cowl-confidentiality">confidentiality</a>;
  [SetterThrows] static attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-type="Label " href="#dom-cowl-integrity">integrity</a>;

  [SetterThrows] static attribute <a data-link-type="idl-name" href="#privilege0">Privilege</a> <a class="idl-code" data-link-type="attribute" data-type="Privilege " href="#dom-cowl-privilege">privilege</a>;
};

dictionary <a href="#dictdef-cilabel">CILabel</a> {
  <a data-link-type="idl-name" href="#label1">Label</a>? <a data-type="Label? " href="#dom-cilabel-confidentiality">confidentiality</a>;
  <a data-link-type="idl-name" href="#label1">Label</a>? <a data-type="Label? " href="#dom-cilabel-integrity">integrity</a>;
};

[<a class="idl-code" data-link-type="constructor" href="#dom-labeledobject-labeledobjectobj-labels">Constructor</a>(object <a href="#dom-labeledobject-labeledobjectobj-labels-obj">obj</a>, <a data-link-type="idl-name" href="#dictdef-cilabel">CILabel</a> <a href="#dom-labeledobject-labeledobjectobj-labels-labels">labels</a>)]
interface <a href="#labeledobject">LabeledObject</a> {
  readonly attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="Label " href="#dom-labeledobject-confidentiality">confidentiality</a>;
  readonly attribute <a data-link-type="idl-name" href="#label1">Label</a> <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="Label " href="#dom-labeledobject-integrity">integrity</a>;

  [GetterThrows] readonly attribute object <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="object " href="#dom-labeledobject-protectedobject">protectedObject</a>;

  [Throws] <a data-link-type="idl-name" href="#labeledobject">LabeledObject</a> <a href="#dom-labeledobject-clonenewlabels">clone</a>(<a data-link-type="idl-name" href="#dictdef-cilabel">CILabel</a> <a href="#dom-labeledobject-clonenewlabels-newlabels">newLabels</a>);
};

partial interface <a class="idl-code" data-link-type="interface" href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a> {
  void <a class="idl-code" data-link-type="method" href="#dom-xmlhttprequest-sendlobj">send</a>(<a data-link-type="idl-name" href="#labeledobject">LabeledObject</a> <a href="#dom-xmlhttprequest-sendlobj-lobj">lobj</a>);
};

enum XMLHttpRequestResponseType {
  ... existing response types ...,
  "labeled-text"
};

[<a href="#dom-lworker-lworkerscripturl-initstate">Constructor</a>(DOMString <a href="#dom-lworker-lworkerscripturl-initstate-scripturl">scriptURL</a>, <a data-link-type="idl-name">InitCOWLstate</a>? <a href="#dom-lworker-lworkerscripturl-initstate-initstate">initState</a>)]
interface <a href="#lworker">LWorker</a> : <a data-link-type="idl-name" href="http://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  void <a href="#dom-lworker-postmessagemessage">postMessage</a>(any <a href="#dom-lworker-postmessagemessage-message">message</a>);
  [TreatNonCallableAsNull] attribute <a data-link-type="idl-name">Function</a>? <a data-type="Function? " href="#dom-lworker-onmessage">onmessage</a>;
}

interface <a href="#lworkerglobalscope">LWorkerGlobalScope</a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a> {
};

</pre>
  <h2 class="no-num heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> mention labeled-blob<a href="#issue-f288fb98"> ↵ </a></div>
   <div class="issue"> define combining<a href="#issue-cc6f8db9"> ↵ </a></div>
   <div class="issue"> Current WebIDL implementation requires an underscore for
    certain identifiers. Can we rename <code>_or</code> to
    <code>or</code>?<a href="#issue-afa876b4"> ↵ </a></div>
   <div class="issue"> describe the <a data-link-type="functionish" href="#dom-label-tojson">toJSON()</a> and <a data-link-type="functionish" href="#dom-label-fromjsonobj">fromJSON()</a><a href="#issue-620ca5f0"> ↵ </a></div>
   <div class="issue"> for discussion: should privileges be used explicitly
      instead?<a href="#issue-e1bb8a0a"> ↵ </a></div>
   <div class="issue"> receive too..<a href="#issue-05c32959"> ↵ </a></div>
   <div class="issue"> describe <code>clone</code><a href="#issue-8d80fc2e"> ↵ </a></div>
   <div class="issue"> send() is not well-defined. Should we only allow JSON
      objects for LabeldObject? Or should we have a header associated
      with object and use normal serialization?<a href="#issue-8e9dcf2b"> ↵ </a></div>
   <div class="issue"> Should we have labeld-json, labeled-blob, etc.?<a href="#issue-3f45d629"> ↵ </a></div>
   <div class="issue"> completed definition for XHR response.<a href="#issue-656b48b1"> ↵ </a></div>
   <div class="issue"> describe response header grammar<a href="#issue-e30b85a5"> ↵ </a></div>
   <div class="issue"> describe how response header is processes<a href="#issue-f4bc3b24"> ↵ </a></div>
   <div class="issue"> describe how labeled headers and XHR work<a href="#issue-8027d210"> ↵ </a></div>
   <div class="issue"> describe request header grammar<a href="#issue-1d09bad5"> ↵ </a></div>
   <div class="issue"> describe worker interface<a href="#issue-1a34a695"> ↵ </a></div>
   <div class="issue"> describe worker global<a href="#issue-b4d466bf"> ↵ </a></div>
   <div class="issue"> describe the reduction algorithm<a href="#issue-a82506bb"> ↵ </a></div>
   <div class="issue"> describe the subsumes algorithm<a href="#issue-3dc7e411"> ↵ </a></div>
   <div class="issue"> describe downgrade<a href="#issue-c98f93fc"> ↵ </a></div>
   <div class="issue"> describe taint<a href="#issue-9c43f37a"> ↵ </a></div>
   <div class="issue"> describe write check<a href="#issue-821539a6"> ↵ </a></div>
   <div class="issue"> describe LabeldObject serialization<a href="#issue-a91b62a7"> ↵ </a></div>
   <div class="issue"> most of the spec talks about contexts not at all about
    workers; should revise to be more general. (Should mostly be
    straightforward.)<a href="#issue-19556c70"> ↵ </a></div></div></body>
</html>